import{aq as n,r as g,D as e,ai as C,G as x,E as T,bo as w,ah as N,bp as z,ar as o,ac as p,Q as V,b4 as P,aN as k,az as y,bq as A,br as B,bs as L,bt as W,bu as U,aj as $,a2 as G,H as F,J as d,bv as H,bw as J,bj as Q,as as D}from"./index-D7_jgbed.js";const K="_form_1f6j5_1",X={form:K};function Y(m){const{data:s,onOk:r,onDelete:h,onCancel:a,...c}=m,[t]=n.useForm(),[j,f]=g.useState(s==null?void 0:s.thumb);g.useEffect(()=>{m.open?(t.setFieldsValue(s),f(s==null?void 0:s.thumb)):(t.resetFields(),f(void 0))},[m.open,s]);function i(b){r==null||r(b)}const u=b=>{const I=b.target.value;f(I)},v=()=>{p.error("头像链接无效，请检查URL是否正确")};return e.jsx(C,{title:s?"修改演员信息":"添加新演员",...c,width:420,onCancel:a,footer:[s&&e.jsx(x,{danger:!0,onClick:h,children:"删除"},"delete"),e.jsx(x,{onClick:a,children:"取消"},"cancel"),e.jsx(x,{type:"primary",onClick:()=>t.submit(),children:"确定"},"submit")],children:e.jsxs(n,{form:t,layout:"vertical",onFinish:i,initialValues:s,children:[e.jsxs(T,{direction:"vertical",style:{width:"100%",display:"flex",alignItems:"center",marginBottom:24},children:[e.jsx(w,{size:80,icon:e.jsx(N,{}),src:j&&z(j),onError:()=>(v(),!0),style:{border:"2px solid #f0f0f0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:8},children:j?"预览头像":"暂无头像"})]}),e.jsx(n.Item,{name:"name",label:"演员姓名",rules:[{required:!0,message:"请输入演员姓名"}],children:e.jsx(o,{placeholder:"请输入演员姓名"})}),e.jsx(n.Item,{name:"thumb",label:"头像链接",extra:"输入完整的图片URL或相对路径",children:e.jsx(o,{placeholder:"请输入头像链接",onChange:u})})]})})}function Z(m){const{value:s,onChange:r}=m,[h,a]=g.useState(void 0),[c,t]=g.useState(void 0);function j(i){if(h==="add"){if(s!=null&&s.some(u=>u.name===i.name))return p.error("该演员已存在");r==null||r([...s||[],i])}else h=="edit"&&(s[c]=i,r==null||r(s&&[...s]));a(void 0),t(void 0)}function f(){r==null||r(s==null?void 0:s.filter((i,u)=>u!=c)),a(void 0),t(void 0)}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(V.Title,{level:5,style:{marginBottom:12},children:"演员信息"}),s&&s.length>0?e.jsx(T,{direction:"vertical",style:{width:"100%"},children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:12},children:[s.map((i,u)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[e.jsx(w,{style:{cursor:"pointer",border:"2px solid #f0f0f0",transition:"all 0.3s"},size:64,src:(i==null?void 0:i.thumb)&&z(i.thumb),onClick:()=>{a("edit"),t(u)}}),e.jsx(V.Text,{style:{marginTop:4,maxWidth:64,textAlign:"center",fontSize:12},ellipsis:{tooltip:i==null?void 0:i.name},children:i==null?void 0:i.name}),e.jsx(x,{size:"small",type:"text",icon:e.jsx(P,{}),style:{position:"absolute",top:-8,right:-8,background:"#fff",borderRadius:"50%",border:"1px solid #f0f0f0",padding:0,height:24,width:24,display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>{a("edit"),t(u)}})]},i.name)),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(w,{style:{cursor:"pointer",backgroundColor:"#fafafa",border:"1px dashed #d9d9d9",display:"flex",justifyContent:"center",alignItems:"center",transition:"all 0.3s",color:"#999"},size:64,icon:e.jsx(k,{}),onClick:()=>{a("add"),t(void 0)}}),e.jsx(V.Text,{style:{marginTop:4,fontSize:12},children:"添加演员"})]})]})}):e.jsx(x,{icon:e.jsx(k,{}),onClick:()=>{a("add"),t(void 0)},children:"添加演员"})]}),e.jsx(Y,{data:c!=null&&s&&s[c],open:!!h,onOk:j,onCancel:()=>a(void 0),onDelete:f})]})}function ee(m){const{path:s,mode:r,transMode:h,onOk:a,...c}=m,[t]=n.useForm(),{run:j,loading:f}=y(R,{manual:!0,onSuccess:l=>{t.setFieldsValue(l)}}),{run:i,loading:u}=y(A,{manual:!0,onSuccess:l=>{delete l.data.data.is_zh,delete l.data.data.is_uncensored,t.setFieldsValue(l.data.data),p.success("刮削成功")}}),{run:v,loading:b}=y(B,{manual:!0,onSuccess:l=>{p.success("保存成功"),a==null||a(l.request.data)}}),{run:I,loading:E}=y(L,{manual:!0,onSuccess:l=>{p.success("删除成功"),a==null||a(l.request.data)}});async function R(l){let S=await W(l);return S.num||(S=await U(l)),S}function _(){const l=t.getFieldValue("num");return l?i(l):p.error("请输入番号")}function q(l){return l.path=s,v(l,r,h)}function M(){C.confirm({title:"是否确认删除",onOk:()=>{I(s)}})}return g.useEffect(()=>{c.open&&s?j(s):t.resetFields()},[c.open]),e.jsx(C,{...c,footer:[r==="video"&&e.jsxs(e.Fragment,{children:[e.jsx(x,{onClick:M,danger:!0,loading:E,children:"删除"}),e.jsx($,{type:"vertical"})]}),e.jsx(x,{onClick:_,loading:u,children:"刮削"},"scrape"),e.jsx(x,{type:"primary",loading:b,onClick:()=>t.submit(),children:"确定"},"save")],children:f?e.jsx("div",{className:"text-center",children:e.jsx(G,{spinning:!0})}):e.jsx(n,{className:X.form,form:t,layout:"vertical",onFinish:q,children:e.jsxs(F,{gutter:[30,15],children:[e.jsxs(d,{span:24,md:10,lg:10,children:[e.jsx(n.Item,{noStyle:!0,name:"cover",children:e.jsx(H,{})}),e.jsx("br",{}),e.jsx(n.Item,{label:"演员",name:"actors",children:e.jsx(Z,{})}),e.jsx("br",{}),e.jsx(n.Item,{label:"网站",name:"website",children:e.jsx(J,{})})]}),e.jsx(d,{span:24,md:14,lg:14,children:e.jsxs(F,{gutter:[15,15],children:[e.jsx(d,{span:8,children:e.jsx(n.Item,{name:"num",label:"番号",rules:[{required:!0,message:"请输入番号"}],children:e.jsx(o,{})})}),e.jsx(d,{span:8,children:e.jsx(n.Item,{name:"premiered",label:"发行时间",children:e.jsx(o,{})})}),e.jsx(d,{span:8,children:e.jsx(n.Item,{name:"rating",label:"评分",children:e.jsx(o,{})})}),e.jsx(d,{span:24,children:e.jsx(n.Item,{name:"title",label:"标题",children:e.jsx(o,{})})}),e.jsx(d,{span:24,children:e.jsx(n.Item,{name:"outline",label:"大纲",children:e.jsx(o.TextArea,{})})}),e.jsx(d,{span:8,children:e.jsx(n.Item,{name:"studio",label:"制造商",children:e.jsx(o,{})})}),e.jsx(d,{span:8,children:e.jsx(n.Item,{name:"publisher",label:"发行商",children:e.jsx(o,{})})}),e.jsx(d,{span:8,children:e.jsx(n.Item,{name:"director",label:"导演",children:e.jsx(o,{})})}),e.jsx(d,{span:24,children:e.jsx(n.Item,{name:"tags",label:"类别",children:e.jsx(Q,{mode:"tags"})})}),e.jsx(d,{span:12,children:e.jsx(n.Item,{name:"series",label:"系列",children:e.jsx(o,{})})}),e.jsx(d,{span:12,children:e.jsx(n.Item,{name:"runtime",label:"时长(分钟)",children:e.jsx(o,{})})}),e.jsx(d,{span:8,children:e.jsx(n.Item,{name:"is_zh",label:"是否中文",valuePropName:"checked",initialValue:!1,children:e.jsx(D,{})})}),e.jsx(d,{span:8,children:e.jsx(n.Item,{name:"is_uncensored",label:"是否无码",valuePropName:"checked",initialValue:!1,children:e.jsx(D,{})})})]})})]})})})}export{ee as V};
