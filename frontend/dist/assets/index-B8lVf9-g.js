import{r as d,I as O,_ as z,aB as c,aQ as B,aR as E,aS as k,F as e,ak as F,J as v,aT as U,aC as w,U as I,aU as y,O as C,aV as _,ae as S,aN as D,Y as H,aW as $,aO as P,aX as T,av as u,S as V,R as b,G as g,at as A,N as x,ap as L,aD as W,aY as Y,ab as q,W as N,aP as G,aZ as J}from"./index-BjFckdMp.js";var Q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},X=function(n,o){return d.createElement(O,z({},n,{ref:o,icon:Q}))},Z=d.forwardRef(X);function K(t){const{onResubscribe:n,...o}=t,{data:p,loading:l,run:i,refresh:h}=c(B,{manual:!0}),{loading:r,run:j}=c(E,{manual:!0,onSuccess:()=>{S.success("重新订阅成功"),n()}}),{loading:m,run:f}=c(k,{manual:!0,onSuccess:()=>{S.success("订阅历史删除成功"),h()}});return d.useEffect(()=>{t.open&&i()},[t.open]),e.jsx(F,{title:"订阅历史",width:800,footer:null,loading:l,...o,children:e.jsx(v,{dataSource:p,itemLayout:"horizontal",renderItem:a=>e.jsxs("div",{className:"relative group",children:[e.jsx(v.Item,{children:e.jsx(v.Item.Meta,{avatar:e.jsx("div",{className:"w-24",children:e.jsx(w,{src:a.cover})}),title:e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.title}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.actors}),e.jsx("div",{className:"text-xs mt-0.5",children:U(a.update_time).fromNow()})]})})}),e.jsx("div",{className:"absolute inset-0 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity duration-500 flex justify-center items-center",children:e.jsxs(I,{size:"large",children:[e.jsx(y,{title:"重新订阅",children:e.jsx(C,{size:"large",icon:e.jsx(Z,{}),type:"primary",shape:"circle",loading:r,onClick:()=>j(a.id)})}),e.jsx(y,{title:"删除历史",children:e.jsx(C,{size:"large",icon:e.jsx(_,{}),type:"primary",danger:!0,shape:"circle",loading:m,onClick:()=>f(a.id)})})]})})]})})})}function se(){const{message:t}=D.useApp(),n=H(),{data:o=[],loading:p,refresh:l}=c($,{}),[i,h]=d.useState(),{setOpen:r,modalProps:j,form:m}=P({service:T,onOk:()=>{r(!1),l()}}),[f,a]=d.useState(!1),{run:M}=c(k,{manual:!0,onSuccess:()=>{t.success("删除成功"),r(!1),l()}});if(p)return e.jsx(u,{children:e.jsx(V,{active:!0})});const R=o.filter(s=>i?s.title.toUpperCase().includes(i.toUpperCase())||s.num.toUpperCase().includes(i.toUpperCase()):!0);return e.jsxs("div",{children:[e.jsx(b,{children:e.jsx(g,{span:24,lg:{span:6,offset:18},children:e.jsx(A.Search,{allowClear:!0,enterButton:!0,style:{marginBottom:15},onSearch:h})})}),e.jsx(b,{gutter:[15,15],children:R.length>0?R.map(s=>e.jsx(g,{span:24,md:12,lg:6,children:e.jsx(u,{hoverable:!0,size:"small",cover:e.jsx(w,{src:s.cover}),onClick:()=>r(!0,s),children:e.jsx(u.Meta,{title:s.title||s.num,description:e.jsxs("div",{className:"flex",children:[e.jsxs(I,{size:[0,"small"],wrap:!0,className:"flex-1",children:[s.premiered&&e.jsx(x,{bordered:!1,children:s.premiered}),s.is_hd&&e.jsx(x,{color:"red",bordered:!1,children:"高清"}),s.is_zh&&e.jsx(x,{color:"blue",bordered:!1,children:"中文"}),s.is_uncensored&&e.jsx(x,{color:"green",bordered:!1,children:"无码"})]}),e.jsx(y,{title:"搜索",children:e.jsx("div",{className:"px-2",onClick:()=>n({to:"/search",search:{num:s.num}}),children:e.jsx(L,{})})})]})})})},s.id)):e.jsx(g,{span:24,children:e.jsx(u,{children:e.jsx(W,{description:"无订阅"})})})}),e.jsx(Y,{width:1100,form:m,onDelete:M,...j}),e.jsx(K,{open:f,onCancel:()=>a(!1),onResubscribe:()=>{l(),a(!1)}}),e.jsx(e.Fragment,{children:q.createPortal(e.jsxs(e.Fragment,{children:[e.jsx(N,{icon:e.jsx(G,{}),type:"primary",onClick:()=>r(!0)}),e.jsx(N,{icon:e.jsx(J,{}),onClick:()=>a(!0)})]}),document.getElementsByClassName("index-float-button-group")[0])})]})}export{se as component};
