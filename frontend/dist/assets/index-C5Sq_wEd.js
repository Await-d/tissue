import{r as u,I as O,_ as B,af as E,aB as d,aQ as F,aR as U,aS as w,F as e,ak as _,J as y,aT as D,aC as I,U as M,aU as h,O as R,ap as z,aV as H,ae as b,aN as $,Y as P,aW as T,aO as V,aX as A,av as x,S as L,R as k,G as C,at as W,N as p,aD as Y,aY as q,ab as G,W as N,aP as J,aZ as Q}from"./index-BQ4m4hxf.js";var X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},Z=function(n,o){return u.createElement(O,B({},n,{ref:o,icon:X}))},K=u.forwardRef(Z);function ee(t){const{onResubscribe:n,...o}=t,j=E(),{data:l,loading:i,run:m,refresh:r}=d(F,{manual:!0}),{loading:f,run:v}=d(U,{manual:!0,onSuccess:()=>{b.success("重新订阅成功"),n()}}),{loading:g,run:c}=d(w,{manual:!0,onSuccess:()=>{b.success("订阅历史删除成功"),r()}});return u.useEffect(()=>{t.open&&m()},[t.open]),e.jsx(_,{title:"订阅历史",width:800,footer:null,loading:i,...o,children:e.jsx(y,{dataSource:l,itemLayout:"horizontal",renderItem:a=>e.jsxs("div",{className:"relative group",children:[e.jsx(y.Item,{children:e.jsx(y.Item.Meta,{avatar:e.jsx("div",{className:"w-24",children:e.jsx(I,{src:a.cover})}),title:e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.title}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.actors}),e.jsx("div",{className:"text-xs mt-0.5",children:D(a.update_time).fromNow()})]})})}),e.jsx("div",{className:"absolute inset-0 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity duration-500 flex justify-center items-center",children:e.jsxs(M,{size:"large",children:[e.jsx(h,{title:"搜索",children:e.jsx(R,{size:"large",icon:e.jsx(z,{}),type:"primary",shape:"circle",onClick:()=>{j.navigate({to:"/search",search:{num:a.num}})}})}),e.jsx(h,{title:"重新订阅",children:e.jsx(R,{size:"large",icon:e.jsx(K,{}),type:"primary",shape:"circle",loading:f,onClick:()=>v(a.id)})}),e.jsx(h,{title:"删除历史",children:e.jsx(R,{size:"large",icon:e.jsx(H,{}),type:"primary",danger:!0,shape:"circle",loading:g,onClick:()=>c(a.id)})})]})})]})})})}function ae(){const{message:t}=$.useApp(),n=P(),{data:o=[],loading:j,refresh:l}=d(T,{}),[i,m]=u.useState(),{setOpen:r,modalProps:f,form:v}=V({service:A,onOk:()=>{r(!1),l()}}),[g,c]=u.useState(!1),{run:a}=d(w,{manual:!0,onSuccess:()=>{t.success("删除成功"),r(!1),l()}});if(j)return e.jsx(x,{children:e.jsx(L,{active:!0})});const S=o.filter(s=>i?s.title.toUpperCase().includes(i.toUpperCase())||s.num.toUpperCase().includes(i.toUpperCase()):!0);return e.jsxs("div",{children:[e.jsx(k,{children:e.jsx(C,{span:24,lg:{span:6,offset:18},children:e.jsx(W.Search,{allowClear:!0,enterButton:!0,style:{marginBottom:15},onSearch:m})})}),e.jsx(k,{gutter:[15,15],children:S.length>0?S.map(s=>e.jsx(C,{span:24,md:12,lg:6,children:e.jsx(x,{hoverable:!0,size:"small",cover:e.jsx(I,{src:s.cover}),onClick:()=>r(!0,s),children:e.jsx(x.Meta,{title:s.title||s.num,description:e.jsxs("div",{className:"flex",children:[e.jsxs(M,{size:[0,"small"],wrap:!0,className:"flex-1",children:[s.premiered&&e.jsx(p,{bordered:!1,children:s.premiered}),s.is_hd&&e.jsx(p,{color:"red",bordered:!1,children:"高清"}),s.is_zh&&e.jsx(p,{color:"blue",bordered:!1,children:"中文"}),s.is_uncensored&&e.jsx(p,{color:"green",bordered:!1,children:"无码"})]}),e.jsx(h,{title:"搜索",children:e.jsx("div",{className:"px-2",onClick:()=>n({to:"/search",search:{num:s.num}}),children:e.jsx(z,{})})})]})})})},s.id)):e.jsx(C,{span:24,children:e.jsx(x,{children:e.jsx(Y,{description:"无订阅"})})})}),e.jsx(q,{width:1100,form:v,onDelete:a,...f}),e.jsx(ee,{open:g,onCancel:()=>c(!1),onResubscribe:()=>{l(),c(!1)}}),e.jsx(e.Fragment,{children:G.createPortal(e.jsxs(e.Fragment,{children:[e.jsx(N,{icon:e.jsx(J,{}),type:"primary",onClick:()=>r(!0)}),e.jsx(N,{icon:e.jsx(Q,{}),onClick:()=>c(!0)})]}),document.getElementsByClassName("index-float-button-group")[0])})]})}export{ae as component};
