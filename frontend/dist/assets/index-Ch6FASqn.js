import{r as d,I as E,_ as O,az as c,aO as B,ac as R,aP as H,aQ as k,D as e,ai as U,N as g,aB as M,aR as _,E as I,aS as C,G as b,aT as D,aL as F,W as $,aU as P,aM as T,aV as L,at as u,S as V,H as N,J as y,ar as A,T as x,an as W,aC as q,aW as G,a9 as J,U as w,aN as Q,aX as X}from"./index-AMmT7rUo.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},Y=function(n,o){return d.createElement(E,O({},n,{ref:o,icon:K}))},Z=d.forwardRef(Y);function ee(r){const{onResubscribe:n,...o}=r,{data:p,loading:h,run:l,refresh:i}=c(B,{manual:!0}),{loading:j,run:t}=c(H,{manual:!0,onSuccess:()=>{R.success("重新订阅成功"),n()}}),{loading:m,run:f}=c(k,{manual:!0,onSuccess:()=>{R.success("订阅历史删除成功"),i()}});return d.useEffect(()=>{r.open&&l()},[r.open]),e.jsx(U,{title:"订阅历史",width:800,footer:null,loading:h,...o,children:e.jsx(g,{dataSource:p,itemLayout:"horizontal",renderItem:a=>e.jsxs("div",{className:"relative group",children:[e.jsx(g.Item,{children:e.jsx(g.Item.Meta,{avatar:e.jsx("div",{className:"w-24",children:e.jsx(M,{src:a.cover})}),title:e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.title}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.actors}),e.jsx("div",{className:"text-xs mt-0.5",children:_(a.update_time).fromNow()})]})})}),e.jsx("div",{className:"absolute inset-0 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity duration-500 flex justify-center items-center",children:e.jsxs(I,{size:"large",children:[e.jsx(C,{title:"重新订阅",children:e.jsx(b,{size:"large",icon:e.jsx(Z,{}),type:"primary",shape:"circle",loading:j,onClick:()=>t(a.id)})}),e.jsx(C,{title:"删除历史",children:e.jsx(b,{size:"large",icon:e.jsx(D,{}),type:"primary",danger:!0,shape:"circle",loading:m,onClick:()=>f(a.id)})})]})})]})})})}const ae=function(){const{message:n}=F.useApp(),o=$(),{data:p=[],loading:h,refresh:l}=c(P,{}),[i,j]=d.useState(),{setOpen:t,modalProps:m,form:f}=T({service:L,onOk:()=>{t(!1),l()}}),[a,v]=d.useState(!1),{run:z}=c(k,{manual:!0,onSuccess:()=>{n.success("删除成功"),t(!1),l()}});if(h)return e.jsx(u,{children:e.jsx(V,{active:!0})});const S=p.filter(s=>i?s.title.toUpperCase().includes(i.toUpperCase())||s.num.toUpperCase().includes(i.toUpperCase()):!0);return e.jsxs("div",{children:[e.jsx(N,{children:e.jsx(y,{span:24,lg:{span:6,offset:18},children:e.jsx(A.Search,{allowClear:!0,enterButton:!0,style:{marginBottom:15},onSearch:j})})}),e.jsx(N,{gutter:[15,15],children:S.length>0?S.map(s=>e.jsx(y,{span:24,md:12,lg:6,children:e.jsx(u,{hoverable:!0,size:"small",cover:e.jsx(M,{src:s.cover}),onClick:()=>t(!0,s),children:e.jsx(u.Meta,{title:s.title||s.num,description:e.jsxs("div",{className:"flex",children:[e.jsxs(I,{size:[0,"small"],wrap:!0,className:"flex-1",children:[s.premiered&&e.jsx(x,{bordered:!1,children:s.premiered}),s.is_hd&&e.jsx(x,{color:"red",bordered:!1,children:"高清"}),s.is_zh&&e.jsx(x,{color:"blue",bordered:!1,children:"中文"}),s.is_uncensored&&e.jsx(x,{color:"green",bordered:!1,children:"无码"})]}),e.jsx(C,{title:"搜索",children:e.jsx("div",{className:"px-2",onClick:()=>o({to:"/search",search:{num:s.num}}),children:e.jsx(W,{})})})]})})})},s.id)):e.jsx(y,{span:24,children:e.jsx(u,{children:e.jsx(q,{description:"无订阅"})})})}),e.jsx(G,{width:1100,form:f,onDelete:z,...m}),e.jsx(ee,{open:a,onCancel:()=>v(!1),onResubscribe:()=>{l(),v(!1)}}),e.jsx(e.Fragment,{children:J.createPortal(e.jsxs(e.Fragment,{children:[e.jsx(w,{icon:e.jsx(Q,{}),type:"primary",onClick:()=>t(!0)}),e.jsx(w,{icon:e.jsx(X,{}),onClick:()=>v(!0)})]}),document.getElementsByClassName("index-float-button-group")[0])})]})};export{ae as component};
