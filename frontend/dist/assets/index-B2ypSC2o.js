import{aK as p,az as m,r as l,ac as I,D as t,at as S,ar as g,a3 as k,T as o,b3 as M,aR as C,b4 as D,aT as O,ai as T}from"./index-D7_jgbed.js";import{u as R}from"./index-CtJHTMHq.js";import{M as q}from"./index-D89gJyxg.js";import{V as z}from"./index-SMRBXPG1.js";import"./index-DdYAJnjh.js";async function H(){return(await p.request({url:"/history/",method:"get"})).data}function K(i){return p.request({url:"/history/",method:"delete",params:{history_id:i}})}const $=function(){const{data:c=[],loading:f,refresh:u}=m(H,{}),[n,d]=l.useState(),[x,j]=l.useState(),a=R(x,{wait:1e3}),_=l.useMemo(()=>c.filter(s=>{var e,r,h;return!a||((e=s.num)==null?void 0:e.indexOf(a))>-1||((r=s.source_path)==null?void 0:r.indexOf(a))>-1||((h=s.dest_path)==null?void 0:h.indexOf(a))>-1}),[c,a]),{run:y}=m(K,{manual:!0,onSuccess:()=>{u(),I.success("删除成功")}}),b=[{title:"状态",dataIndex:"status",render:s=>s?t.jsx(o,{color:"success",children:"成功"}):t.jsx(o,{color:"error",children:"失败"})},{title:"番号",dataIndex:"num",render:(s,e)=>t.jsxs("div",{children:[t.jsx("b",{children:s}),t.jsxs("div",{children:[e.is_zh&&t.jsx(o,{color:"blue",children:"中文"}),e.is_uncensored&&t.jsx(o,{color:"green",children:"无码"})]})]})},{title:"路径",dataIndex:"path",render:(s,e)=>t.jsxs("div",{style:{WebkitTextSizeAdjust:"100%",fontSize:14,maxWidth:680},children:[t.jsx("div",{children:e.source_path}),t.jsx("div",{children:"==>"}),t.jsx("div",{children:e.dest_path})]})},{title:"转移方式",dataIndex:"trans_method",render:s=>{const e=M.find(r=>r.value===s);return t.jsx(o,{color:e==null?void 0:e.color,children:e==null?void 0:e.name})}},{title:"时间",dataIndex:"create_time",render:s=>C(s).format("lll")},{title:"",dataIndex:"operations",width:20,fixed:"right",render:(s,e)=>!e.is_admin&&t.jsx(q,{items:v,onClick:r=>w(r,e)})}],v=[{key:"edit",label:"重新整理",icon:t.jsx(D,{})},{key:"delete",label:"删除记录",icon:t.jsx(O,{})}];function w(s,e){s==="edit"?d(e):s==="delete"&&T.confirm({title:"是否确认删除记录",onOk:()=>{y(e.id)}})}return t.jsxs(S,{title:"历史记录",extra:t.jsx(g.Search,{value:x,onChange:s=>j(s.target.value),placeholder:"搜索"}),children:[t.jsx(k,{rowKey:"id",scroll:{x:"max-content"},columns:b,loading:f,dataSource:_}),t.jsx(z,{title:"重新整理",mode:"history",transMode:n!=null&&n.status?"move":n==null?void 0:n.trans_mode,width:1100,path:n!=null&&n.status?n==null?void 0:n.dest_path:n==null?void 0:n.source_path,open:!!n,onCancel:()=>d(void 0),onOk:()=>{d(void 0),u()}})]})};export{$ as component};
