import{aM as m,aB as h,r as l,F as t,av as k,a5 as w,aT as I,at as M,N as i,b6 as g,ak as S,b7 as O,aV as C,ae as D}from"./index-B9DTyTP1.js";import{u as T}from"./index-DfGK_ncm.js";import{M as q}from"./index-BoOFwuzD.js";import{V as R}from"./index-ggQlL-VR.js";import"./index-GdZAhowp.js";async function z(){return(await m.request({url:"/history/",method:"get"})).data}function H(n){return m.request({url:"/history/",method:"delete",params:{history_id:n}})}function A(){const{data:n=[],loading:p,refresh:c}=h(z,{}),[r,d]=l.useState(),[u,f]=l.useState(),o=T(u,{wait:1e3}),j=l.useMemo(()=>n.filter(s=>{var e,a,x;return!o||((e=s.num)==null?void 0:e.indexOf(o))>-1||((a=s.source_path)==null?void 0:a.indexOf(o))>-1||((x=s.dest_path)==null?void 0:x.indexOf(o))>-1}),[n,o]),{run:_}=h(H,{manual:!0,onSuccess:()=>{c(),D.success("删除成功")}}),y=[{title:"状态",dataIndex:"status",render:s=>s?t.jsx(i,{color:"success",children:"成功"}):t.jsx(i,{color:"error",children:"失败"})},{title:"番号",dataIndex:"num",render:(s,e)=>t.jsxs("div",{children:[t.jsx("b",{children:s}),t.jsxs("div",{children:[e.is_zh&&t.jsx(i,{color:"blue",children:"中文"}),e.is_uncensored&&t.jsx(i,{color:"green",children:"无码"})]})]})},{title:"路径",dataIndex:"path",render:(s,e)=>t.jsxs("div",{style:{WebkitTextSizeAdjust:"100%",fontSize:14,maxWidth:680},children:[t.jsx("div",{children:e.source_path}),t.jsx("div",{children:"==>"}),t.jsx("div",{children:e.dest_path})]})},{title:"转移方式",dataIndex:"trans_method",render:s=>{const e=g.find(a=>a.value===s);return t.jsx(i,{color:e==null?void 0:e.color,children:e==null?void 0:e.name})}},{title:"时间",dataIndex:"create_time",render:s=>I(s).format("lll")},{title:"",dataIndex:"operations",width:20,fixed:"right",render:(s,e)=>!e.is_admin&&t.jsx(q,{items:v,onClick:a=>b(a,e)})}],v=[{key:"edit",label:"重新整理",icon:t.jsx(O,{})},{key:"delete",label:"删除记录",icon:t.jsx(C,{})}];function b(s,e){s==="edit"?d(e):s==="delete"&&S.confirm({title:"是否确认删除记录",onOk:()=>{_(e.id)}})}return t.jsxs(k,{title:"历史记录",extra:t.jsx(M.Search,{value:u,onChange:s=>f(s.target.value),placeholder:"搜索"}),children:[t.jsx(w,{rowKey:"id",scroll:{x:"max-content"},columns:y,loading:p,dataSource:j}),t.jsx(R,{title:"重新整理",mode:"history",transMode:r!=null&&r.status?"move":r==null?void 0:r.trans_mode,width:1100,path:r!=null&&r.status?r==null?void 0:r.dest_path:r==null?void 0:r.source_path,open:!!r,onCancel:()=>d(void 0),onOk:()=>{d(void 0),c()}})]})}export{A as component};
