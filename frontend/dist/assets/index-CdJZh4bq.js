import{r as c,I as P,_ as U,ag as _,aA as u,aP as B,aQ as H,aR as z,F as e,al as V,J as y,aS as $,aB as O,U as R,aT as m,O as j,ap as S,aU as D,af as w,aM as A,Z as T,aV as L,aN as X,aW as q,au as h,S as G,R as M,G as C,as as J,N as p,aC as Q,aX as W,ac as Y,X as I,aO as Z,aY as K}from"./index-CPAKaPzh.js";var ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},se=function(n,i){return c.createElement(P,U({},n,{ref:i,icon:ee}))},ae=c.forwardRef(se);function te(t){const{onResubscribe:n,...i}=t,b=_(),{data:l,loading:o,run:x,refresh:d}=u(B,{manual:!0}),{loading:g,run:r}=u(H,{manual:!0,onSuccess:()=>{w.success("重新订阅成功"),n()}}),{loading:f,run:v}=u(z,{manual:!0,onSuccess:()=>{w.success("订阅历史删除成功"),d()}});return c.useEffect(()=>{t.open&&x()},[t.open]),e.jsx(V,{title:"订阅历史",width:800,footer:null,loading:o,...i,children:e.jsx(y,{dataSource:l,itemLayout:"horizontal",renderItem:a=>e.jsxs("div",{className:"relative group",children:[e.jsx(y.Item,{children:e.jsx(y.Item.Meta,{avatar:e.jsx("div",{className:"w-24",children:e.jsx(O,{src:a.cover})}),title:e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.title}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.actors}),e.jsx("div",{className:"text-xs mt-0.5",children:$(a.update_time).fromNow()})]})})}),e.jsx("div",{className:"absolute inset-0 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity duration-500 flex justify-center items-center",children:e.jsxs(R,{size:"large",children:[e.jsx(m,{title:"搜索",children:e.jsx(j,{size:"large",icon:e.jsx(S,{}),type:"primary",shape:"circle",onClick:()=>{b.navigate({to:"/search",search:{num:a.num}})}})}),e.jsx(m,{title:"重新订阅",children:e.jsx(j,{size:"large",icon:e.jsx(ae,{}),type:"primary",shape:"circle",loading:g,onClick:()=>r(a.id)})}),e.jsx(m,{title:"删除历史",children:e.jsx(j,{size:"large",icon:e.jsx(D,{}),type:"primary",danger:!0,shape:"circle",loading:f,onClick:()=>v(a.id)})})]})})]})})})}function ce(){const{message:t}=A.useApp(),n=T(),{data:i=[],loading:b,refresh:l}=u(L,{}),[o,x]=c.useState(),[d,g]=c.useState(""),{setOpen:r,modalProps:f,form:v}=X({service:q,onOk:()=>{r(!1),l()}}),[a,N]=c.useState(!1),{run:E}=u(z,{manual:!0,onSuccess:()=>{t.success("删除成功"),r(!1),l()}});if(b)return e.jsx(h,{className:"subscribe-loading-card",children:e.jsx(G,{active:!0})});const k=i.filter(s=>o?s.title.toUpperCase().includes(o.toUpperCase())||s.num.toUpperCase().includes(o.toUpperCase()):!0);return e.jsxs("div",{className:"subscribe-container",children:[e.jsx(M,{children:e.jsx(C,{span:24,lg:{span:6,offset:18},children:e.jsxs(R.Compact,{className:"subscribe-search-bar",children:[e.jsx(J,{allowClear:!0,value:d,onChange:s=>g(s.target.value),onPressEnter:()=>x(d),placeholder:"搜索番号或标题"}),e.jsx(j,{icon:e.jsx(S,{}),onClick:()=>x(d),className:"subscribe-search-btn"})]})})}),e.jsx(M,{gutter:[15,15],children:k.length>0?k.map(s=>e.jsx(C,{span:24,md:12,lg:6,children:e.jsx(h,{hoverable:!0,size:"small",className:"subscribe-card",cover:e.jsx(O,{src:s.cover}),onClick:()=>r(!0,s),children:e.jsx(h.Meta,{title:e.jsx("div",{className:"subscribe-card-title",children:s.title||s.num}),description:e.jsxs("div",{className:"flex",children:[e.jsxs(R,{size:[0,"small"],wrap:!0,className:"flex-1",children:[s.premiered&&e.jsx(p,{className:"subscribe-tag subscribe-tag-date",children:s.premiered}),s.is_hd&&e.jsx(p,{className:"subscribe-tag subscribe-tag-hd",children:"高清"}),s.is_zh&&e.jsx(p,{className:"subscribe-tag subscribe-tag-zh",children:"中文"}),s.is_uncensored&&e.jsx(p,{className:"subscribe-tag subscribe-tag-uncensored",children:"无码"})]}),e.jsx(m,{title:"搜索",children:e.jsx("div",{className:"subscribe-search-icon",onClick:F=>(F.stopPropagation(),n({to:"/search",search:{num:s.num}})),children:e.jsx(S,{})})})]})})})},s.id)):e.jsx(C,{span:24,children:e.jsx(h,{className:"subscribe-empty-card",children:e.jsx(Q,{description:"无订阅",className:"subscribe-empty"})})})}),e.jsx(W,{width:1100,form:v,onDelete:E,...f}),e.jsx(te,{open:a,onCancel:()=>N(!1),onResubscribe:()=>{l(),N(!1)}}),e.jsx(e.Fragment,{children:Y.createPortal(e.jsxs(e.Fragment,{children:[e.jsx(I,{icon:e.jsx(Z,{}),type:"primary",onClick:()=>r(!0),className:"subscribe-float-btn"}),e.jsx(I,{icon:e.jsx(K,{}),onClick:()=>N(!0),className:"subscribe-float-btn"})]}),document.getElementsByClassName("index-float-button-group")[0])})]})}export{ce as component};
