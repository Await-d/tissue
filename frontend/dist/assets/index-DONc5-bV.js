import{r as u,I as We,_ as te,b3 as R,b as Ie,c as Y,e as X,a as Pe,K as pe,d as Ke,C as De,x as we,bd as Fe,w as He,p as Ge,be as Ve,D as qe,v as Ue,j as Xe,m as Ye,k as H,bf as Je,bg as Qe,l as Ze,bh as en,g as nn,bi as tn,bj as rn,bk as fe,bl as on,A as me,aM as ze,aN as an,a8 as sn,W as ln,$ as cn,aB as ye,F as e,U as G,aU as ee,bm as be,b0 as dn,bn as gn,aV as un,J as U,al as xn,N as le,M as ve,av as oe,R as ie,G as L,H as ne,b2 as hn,a5 as pn,bo as Ce,a$ as D,O as ae,V as je,aD as ce,a0 as fn,am as Se,at as mn,aq as $e,az as yn,bp as bn,bq as vn,br as Cn,bs as ke}from"./index-CY_vu9An.js";import{u as jn}from"./index-B8YVcvua.js";import{I as se}from"./index-Bz5xRaUd.js";import{V as Sn}from"./index-DY9oV3cG.js";import{R as $n}from"./FolderViewOutlined-BH3vJiBb.js";var kn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"},In=function(r,s){return u.createElement(We,te({},r,{ref:s,icon:kn}))},Pn=u.forwardRef(In),Be=R.forwardRef(function(t,r){var s=t.prefixCls,n=t.forceRender,f=t.className,m=t.style,x=t.children,h=t.isActive,C=t.role,y=t.classNames,j=t.styles,$=R.useState(h||n),p=Ie($,2),d=p[0],g=p[1];return R.useEffect(function(){(n||h)&&g(!0)},[n,h]),d?R.createElement("div",{ref:r,className:Y("".concat(s,"-content"),X(X({},"".concat(s,"-content-active"),h),"".concat(s,"-content-inactive"),!h),f),style:m,role:C},R.createElement("div",{className:Y("".concat(s,"-content-box"),y==null?void 0:y.body),style:j==null?void 0:j.body},x)):null});Be.displayName="PanelContent";var wn=["showArrow","headerClass","isActive","onItemClick","forceRender","className","classNames","styles","prefixCls","collapsible","accordion","panelKey","extra","header","expandIcon","openMotion","destroyInactivePanel","children"],Re=R.forwardRef(function(t,r){var s=t.showArrow,n=s===void 0?!0:s,f=t.headerClass,m=t.isActive,x=t.onItemClick,h=t.forceRender,C=t.className,y=t.classNames,j=y===void 0?{}:y,$=t.styles,p=$===void 0?{}:$,d=t.prefixCls,g=t.collapsible,I=t.accordion,c=t.panelKey,b=t.extra,P=t.header,k=t.expandIcon,i=t.openMotion,N=t.destroyInactivePanel,w=t.children,A=Pe(t,wn),z=g==="disabled",B=b!=null&&typeof b!="boolean",E=X(X(X({onClick:function(){x==null||x(c)},onKeyDown:function(S){(S.key==="Enter"||S.keyCode===pe.ENTER||S.which===pe.ENTER)&&(x==null||x(c))},role:I?"tab":"button"},"aria-expanded",m),"aria-disabled",z),"tabIndex",z?-1:0),T=typeof k=="function"?k(t):R.createElement("i",{className:"arrow"}),W=T&&R.createElement("div",te({className:"".concat(d,"-expand-icon")},["header","icon"].includes(g)?E:{}),T),J=Y("".concat(d,"-item"),X(X({},"".concat(d,"-item-active"),m),"".concat(d,"-item-disabled"),z),C),Q=Y(f,"".concat(d,"-header"),X({},"".concat(d,"-collapsible-").concat(g),!!g),j.header),M=Ke({className:Q,style:p.header},["header","icon"].includes(g)?{}:E);return R.createElement("div",te({},A,{ref:r,className:J}),R.createElement("div",M,n&&W,R.createElement("span",te({className:"".concat(d,"-header-text")},g==="header"?E:{}),P),B&&R.createElement("div",{className:"".concat(d,"-extra")},b)),R.createElement(De,te({visible:m,leavedClassName:"".concat(d,"-content-hidden")},i,{forceRender:h,removeOnLeave:N}),function(O,S){var V=O.className,K=O.style;return R.createElement(Be,{ref:S,prefixCls:d,className:V,classNames:j,style:K,styles:p,isActive:m,forceRender:h,role:I?"tabpanel":void 0},w)}))}),zn=["children","label","key","collapsible","onItemClick","destroyInactivePanel"],Bn=function(r,s){var n=s.prefixCls,f=s.accordion,m=s.collapsible,x=s.destroyInactivePanel,h=s.onItemClick,C=s.activeKey,y=s.openMotion,j=s.expandIcon;return r.map(function($,p){var d=$.children,g=$.label,I=$.key,c=$.collapsible,b=$.onItemClick,P=$.destroyInactivePanel,k=Pe($,zn),i=String(I??p),N=c??m,w=P??x,A=function(E){N!=="disabled"&&(h(E),b==null||b(E))},z=!1;return f?z=C[0]===i:z=C.indexOf(i)>-1,R.createElement(Re,te({},k,{prefixCls:n,key:i,panelKey:i,isActive:z,accordion:f,openMotion:y,expandIcon:j,header:g,collapsible:N,onItemClick:A,destroyInactivePanel:w}),d)})},Rn=function(r,s,n){if(!r)return null;var f=n.prefixCls,m=n.accordion,x=n.collapsible,h=n.destroyInactivePanel,C=n.onItemClick,y=n.activeKey,j=n.openMotion,$=n.expandIcon,p=r.key||String(s),d=r.props,g=d.header,I=d.headerClass,c=d.destroyInactivePanel,b=d.collapsible,P=d.onItemClick,k=!1;m?k=y[0]===p:k=y.indexOf(p)>-1;var i=b??x,N=function(z){i!=="disabled"&&(C(z),P==null||P(z))},w={key:p,panelKey:p,header:g,headerClass:I,isActive:k,prefixCls:f,destroyInactivePanel:c??h,openMotion:j,accordion:m,children:r.props.children,onItemClick:N,expandIcon:$,collapsible:i};return typeof r.type=="string"?r:(Object.keys(w).forEach(function(A){typeof w[A]>"u"&&delete w[A]}),R.cloneElement(r,w))};function Nn(t,r,s){return Array.isArray(t)?Bn(t,s):we(r).map(function(n,f){return Rn(n,f,s)})}function Mn(t){var r=t;if(!Array.isArray(r)){var s=Ve(r);r=s==="number"||s==="string"?[r]:[]}return r.map(function(n){return String(n)})}var On=R.forwardRef(function(t,r){var s=t.prefixCls,n=s===void 0?"rc-collapse":s,f=t.destroyInactivePanel,m=f===void 0?!1:f,x=t.style,h=t.accordion,C=t.className,y=t.children,j=t.collapsible,$=t.openMotion,p=t.expandIcon,d=t.activeKey,g=t.defaultActiveKey,I=t.onChange,c=t.items,b=Y(n,C),P=Fe([],{value:d,onChange:function(B){return I==null?void 0:I(B)},defaultValue:g,postState:Mn}),k=Ie(P,2),i=k[0],N=k[1],w=function(B){return N(function(){if(h)return i[0]===B?[]:[B];var E=i.indexOf(B),T=E>-1;return T?i.filter(function(W){return W!==B}):[].concat(qe(i),[B])})};He(!y,"[rc-collapse] `children` will be removed in next major version. Please use `items` instead.");var A=Nn(c,y,{prefixCls:n,accordion:h,openMotion:$,expandIcon:p,collapsible:j,destroyInactivePanel:m,onItemClick:w,activeKey:i});return R.createElement("div",te({ref:r,className:b,style:x,role:h?"tablist":void 0},Ge(t,{aria:!0,data:!0})),A)});const ue=Object.assign(On,{Panel:Re});ue.Panel;const _n=u.forwardRef((t,r)=>{const{getPrefixCls:s}=u.useContext(Ue),{prefixCls:n,className:f,showArrow:m=!0}=t,x=s("collapse",n),h=Y({[`${x}-no-arrow`]:!m},f);return u.createElement(ue.Panel,Object.assign({ref:r},t,{prefixCls:x,className:h}))}),An=t=>{const{componentCls:r,contentBg:s,padding:n,headerBg:f,headerPadding:m,collapseHeaderPaddingSM:x,collapseHeaderPaddingLG:h,collapsePanelBorderRadius:C,lineWidth:y,lineType:j,colorBorder:$,colorText:p,colorTextHeading:d,colorTextDisabled:g,fontSizeLG:I,lineHeight:c,lineHeightLG:b,marginSM:P,paddingSM:k,paddingLG:i,paddingXS:N,motionDurationSlow:w,fontSizeIcon:A,contentPadding:z,fontHeight:B,fontHeightLG:E}=t,T=`${H(y)} ${j} ${$}`;return{[r]:Object.assign(Object.assign({},Qe(t)),{backgroundColor:f,border:T,borderRadius:C,"&-rtl":{direction:"rtl"},[`& > ${r}-item`]:{borderBottom:T,"&:first-child":{[`
            &,
            & > ${r}-header`]:{borderRadius:`${H(C)} ${H(C)} 0 0`}},"&:last-child":{[`
            &,
            & > ${r}-header`]:{borderRadius:`0 0 ${H(C)} ${H(C)}`}},[`> ${r}-header`]:Object.assign(Object.assign({position:"relative",display:"flex",flexWrap:"nowrap",alignItems:"flex-start",padding:m,color:d,lineHeight:c,cursor:"pointer",transition:`all ${w}, visibility 0s`},Ze(t)),{[`> ${r}-header-text`]:{flex:"auto"},[`${r}-expand-icon`]:{height:B,display:"flex",alignItems:"center",paddingInlineEnd:P},[`${r}-arrow`]:Object.assign(Object.assign({},en()),{fontSize:A,transition:`transform ${w}`,svg:{transition:`transform ${w}`}}),[`${r}-header-text`]:{marginInlineEnd:"auto"}}),[`${r}-collapsible-header`]:{cursor:"default",[`${r}-header-text`]:{flex:"none",cursor:"pointer"},[`${r}-expand-icon`]:{cursor:"pointer"}},[`${r}-collapsible-icon`]:{cursor:"unset",[`${r}-expand-icon`]:{cursor:"pointer"}}},[`${r}-content`]:{color:p,backgroundColor:s,borderTop:T,[`& > ${r}-content-box`]:{padding:z},"&-hidden":{display:"none"}},"&-small":{[`> ${r}-item`]:{[`> ${r}-header`]:{padding:x,paddingInlineStart:N,[`> ${r}-expand-icon`]:{marginInlineStart:t.calc(k).sub(N).equal()}},[`> ${r}-content > ${r}-content-box`]:{padding:k}}},"&-large":{[`> ${r}-item`]:{fontSize:I,lineHeight:b,[`> ${r}-header`]:{padding:h,paddingInlineStart:n,[`> ${r}-expand-icon`]:{height:E,marginInlineStart:t.calc(i).sub(n).equal()}},[`> ${r}-content > ${r}-content-box`]:{padding:i}}},[`${r}-item:last-child`]:{borderBottom:0,[`> ${r}-content`]:{borderRadius:`0 0 ${H(C)} ${H(C)}`}},[`& ${r}-item-disabled > ${r}-header`]:{"\n          &,\n          & > .arrow\n        ":{color:g,cursor:"not-allowed"}},[`&${r}-icon-position-end`]:{[`& > ${r}-item`]:{[`> ${r}-header`]:{[`${r}-expand-icon`]:{order:1,paddingInlineEnd:0,paddingInlineStart:P}}}}})}},En=t=>{const{componentCls:r}=t,s=`> ${r}-item > ${r}-header ${r}-arrow`;return{[`${r}-rtl`]:{[s]:{transform:"rotate(180deg)"}}}},Tn=t=>{const{componentCls:r,headerBg:s,borderlessContentPadding:n,borderlessContentBg:f,colorBorder:m}=t;return{[`${r}-borderless`]:{backgroundColor:s,border:0,[`> ${r}-item`]:{borderBottom:`1px solid ${m}`},[`
        > ${r}-item:last-child,
        > ${r}-item:last-child ${r}-header
      `]:{borderRadius:0},[`> ${r}-item:last-child`]:{borderBottom:0},[`> ${r}-item > ${r}-content`]:{backgroundColor:f,borderTop:0},[`> ${r}-item > ${r}-content > ${r}-content-box`]:{padding:n}}}},Ln=t=>{const{componentCls:r,paddingSM:s}=t;return{[`${r}-ghost`]:{backgroundColor:"transparent",border:0,[`> ${r}-item`]:{borderBottom:0,[`> ${r}-content`]:{backgroundColor:"transparent",border:0,[`> ${r}-content-box`]:{paddingBlock:s}}}}}},Wn=t=>({headerPadding:`${t.paddingSM}px ${t.padding}px`,headerBg:t.colorFillAlter,contentPadding:`${t.padding}px 16px`,contentBg:t.colorBgContainer,borderlessContentPadding:`${t.paddingXXS}px 16px ${t.padding}px`,borderlessContentBg:"transparent"}),Kn=Xe("Collapse",t=>{const r=Ye(t,{collapseHeaderPaddingSM:`${H(t.paddingXS)} ${H(t.paddingSM)}`,collapseHeaderPaddingLG:`${H(t.padding)} ${H(t.paddingLG)}`,collapsePanelBorderRadius:t.borderRadiusLG});return[An(r),Tn(r),Ln(r),En(r),Je(r)]},Wn),Dn=u.forwardRef((t,r)=>{const{getPrefixCls:s,direction:n,expandIcon:f,className:m,style:x}=nn("collapse"),{prefixCls:h,className:C,rootClassName:y,style:j,bordered:$=!0,ghost:p,size:d,expandIconPosition:g="start",children:I,destroyInactivePanel:c,destroyOnHidden:b,expandIcon:P}=t,k=tn(M=>{var O;return(O=d??M)!==null&&O!==void 0?O:"middle"}),i=s("collapse",h),N=s(),[w,A,z]=Kn(i),B=u.useMemo(()=>g==="left"?"start":g==="right"?"end":g,[g]),E=P??f,T=u.useCallback((M={})=>{const O=typeof E=="function"?E(M):u.createElement(rn,{rotate:M.isActive?n==="rtl"?-90:90:void 0,"aria-label":M.isActive?"expanded":"collapsed"});return fe(O,()=>{var S;return{className:Y((S=O.props)===null||S===void 0?void 0:S.className,`${i}-arrow`)}})},[E,i,n]),W=Y(`${i}-icon-position-${B}`,{[`${i}-borderless`]:!$,[`${i}-rtl`]:n==="rtl",[`${i}-ghost`]:!!p,[`${i}-${k}`]:k!=="middle"},m,C,y,A,z),J=u.useMemo(()=>Object.assign(Object.assign({},on(N)),{motionAppear:!1,leavedClassName:`${i}-content-hidden`}),[N,i]),Q=u.useMemo(()=>I?we(I).map((M,O)=>{var S,V;const K=M.props;if(K!=null&&K.disabled){const Z=(S=M.key)!==null&&S!==void 0?S:String(O),de=Object.assign(Object.assign({},me(M.props,["disabled"])),{key:Z,collapsible:(V=K.collapsible)!==null&&V!==void 0?V:"disabled"});return fe(M,de)}return M}):null,[I]);return w(u.createElement(ue,Object.assign({ref:r,openMotion:J},me(t,["rootClassName"]),{expandIcon:T,prefixCls:i,className:W,style:Object.assign(Object.assign({},x),j),destroyInactivePanel:b??c}),Q))}),Fn=Object.assign(Dn,{Panel:_n});async function Hn(t){return(await ze.request({url:"/download/",method:"get",params:t})).data}function Gn(t){return ze.request({url:"/download/complete",method:"get",params:{torrent_hash:t}})}const{useToken:Vn}=sn;function Qn(){var he;const{message:t,modal:r}=an.useApp(),{token:s}=Vn(),n=ln(),f=cn(),[m,x]=u.useState(),[h,C]=u.useState(),y=jn(h,{wait:1e3}),[j,$]=u.useState(!0),[p,d]=u.useState(!0),[g,I]=u.useState(!1),[c,b]=u.useState({status:"all",sizeRange:[0,1e4],dateRange:null,sortBy:"date",sortOrder:"desc"}),[P,k]=u.useState(!1),[i,N]=u.useState(null),[w,A]=u.useState(""),[z,B]=u.useState(!1),[E,T]=u.useState(!1),[W,J]=u.useState(null),[Q,M]=u.useState(!1),O=u.useMemo(()=>((W==null?void 0:W.torrent_results)||[]).filter(o=>(o.deleted_files||0)>0),[W]),{data:S=[],loading:V,refresh:K}=ye(()=>Hn({include_success:j,include_failed:p}),{refreshDeps:[j,p]}),Z=u.useMemo(()=>{let o=S.filter(a=>!y||a.name.indexOf(y)!==-1||a.files.some(v=>v.name.indexOf(y)!==-1||v.path.indexOf(y)!==-1));if(g&&(o=o.filter(a=>{const l=Array.isArray(a.tags)?a.tags:[];if(c.status!=="all"){const v=a.files.some(q=>q.progress>=1),_=a.files.some(q=>q.progress>0&&q.progress<1),F=l.includes("整理失败"),re=!v&&!_&&!F;if(c.status==="completed"&&!v||c.status==="downloading"&&!_||c.status==="failed"&&!(F||re))return!1}return!0})),g){const a=l=>{const v=(l||"").trim().toUpperCase(),_=parseFloat(v.replace(/[^\d.]/g,""));return Number.isFinite(_)?v.includes("TB")?_*1024:v.includes("GB")?_:v.includes("MB")?_/1024:v.includes("KB")?_/1048576:_:0};if(c.sortBy==="date")return c.sortOrder==="asc"&&(o=[...o].reverse()),o;o=[...o].sort((l,v)=>{const _=l.files.length?l.files.reduce((q,ge)=>q+(ge.progress||0),0)/l.files.length:0,F=v.files.length?v.files.reduce((q,ge)=>q+(ge.progress||0),0)/v.files.length:0,re=c.sortBy==="progress"?_-F:c.sortBy==="size"?a(l.size||"")-a(v.size||""):0;return c.sortOrder==="asc"?re:-re})}return o},[S,y,g,c]),{run:de}=ye(Gn,{manual:!0,onSuccess:()=>{t.success("标记成功"),K()}}),Ne=async o=>{try{B(!0),A(o);const a=await vn(o);a.success?(N(a.data),k(!0)):t.error(a.message||"获取清理预览失败")}catch(a){t.error((a==null?void 0:a.message)||"获取清理预览失败")}finally{B(!1)}},Me=async()=>{try{B(!0);const o=await Cn(w,!1);o.success?(t.success("清理成功"),k(!1),N(null),K()):t.error(o.message||"清理失败")}catch(o){t.error((o==null?void 0:o.message)||"清理失败")}finally{B(!1)}},Oe=()=>{k(!1),N(null),A("")},xe=async()=>{try{M(!0);const o=await ke(void 0,!0,j,p);o.success&&o.data?(J(o.data),T(!0)):t.error(o.message||"获取批量清理预览失败")}catch(o){t.error((o==null?void 0:o.message)||"获取批量清理预览失败")}finally{M(!1)}},_e=async()=>{var o;try{M(!0);const a=await ke(void 0,!1,j,p);a.success?(t.success(`批量清理成功，共清理 ${((o=a.data)==null?void 0:o.total_deleted_files)||0} 个文件`),T(!1),J(null),K()):t.error(a.message||"批量清理失败")}catch(a){t.error((a==null?void 0:a.message)||"批量清理失败")}finally{M(!1)}},Ae=()=>{T(!1),J(null)},Ee=o=>{if(o){const a=new URLSearchParams(window.location.search),l=a.get("source")||"javdb",v=a.get("url")||"";f({to:`/video/${o}`,search:{source:l,url:v}})}else t.info("无法识别番号，无法跳转到详情页面")},Te=o=>{f({to:"/actor",search:{actorName:o}})},Le=Z.map(o=>({key:o.hash,label:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[e.jsx("span",{style:{color:n.textPrimary,fontWeight:500,fontSize:"14px"},children:o.name}),e.jsx(G,{children:(()=>{const a=o.files.length,l=o.files.filter(F=>F.progress>=1).length,v=o.files.filter(F=>F.progress>0&&F.progress<1).length,_=o.files.reduce((F,re)=>F+re.progress,0)/a;return e.jsxs(e.Fragment,{children:[e.jsxs(le,{style:{background:l===a?"rgba(82, 196, 26, 0.2)":v>0?n.rgba("gold",.2):n.borderPrimary,borderColor:l===a?"#52c41a":v>0?n.goldPrimary:n.borderPrimary,color:l===a?"#52c41a":v>0?n.goldLight:n.textSecondary,fontWeight:500},children:[l,"/",a," 文件"]}),e.jsx(ve,{percent:Math.round(_*100),size:"small",style:{width:80},strokeColor:l===a?"#52c41a":{"0%":n.goldPrimary,"100%":n.goldLight},trailColor:"rgba(255, 255, 255, 0.08)"})]})})()})]}),children:e.jsx(U,{itemLayout:"horizontal",dataSource:o.files,style:{background:n.bgBase,borderRadius:"8px",padding:"12px"},renderItem:a=>e.jsx(U.Item,{style:{background:n.bgElevated,borderRadius:"8px",padding:"12px 16px",marginBottom:"8px",border:"1px solid rgba(255, 255, 255, 0.08)",transition:"all 0.3s ease"},onMouseEnter:l=>{l.currentTarget.style.borderColor=n.goldPrimary,l.currentTarget.style.background=n.bgContainer},onMouseLeave:l=>{l.currentTarget.style.borderColor=n.borderPrimary,l.currentTarget.style.background=n.bgElevated},actions:[e.jsx(ee,{title:"整理",children:e.jsx(se,{onClick:()=>{x(a.path)},children:e.jsx($n,{style:{fontSize:s.sizeLG}})})},"organize")],children:e.jsx(U.Item.Meta,{title:e.jsxs("span",{children:[a.num?e.jsx("button",{type:"button",onClick:()=>Ee(a.num),style:{background:"transparent",border:"none",padding:0,margin:0,cursor:"pointer",color:n.goldPrimary,fontWeight:500,transition:"color 0.3s ease"},onMouseEnter:l=>{l.currentTarget.style.color=n.goldLight},onMouseLeave:l=>{l.currentTarget.style.color=n.goldPrimary},children:a.name}):e.jsx("span",{style:{color:n.textPrimary,fontWeight:500},children:a.name}),e.jsx(le,{style:{marginLeft:5,background:"rgba(82, 196, 26, 0.2)",borderColor:"#52c41a",color:"#52c41a",fontWeight:500},children:a.size}),a.progress<1&&e.jsx(ve,{percent:Math.round(a.progress*100),size:"small",style:{width:100,marginLeft:10,display:"inline-block"},strokeColor:{"0%":n.goldPrimary,"100%":n.goldLight},trailColor:"rgba(255, 255, 255, 0.08)"})]}),description:e.jsxs("div",{children:[e.jsx("div",{style:{color:n.textTertiary,fontSize:"13px",marginTop:"4px"},children:a.path}),a.actors&&a.actors.length>0&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(xn,{style:{marginRight:6,color:n.textSecondary}}),a.actors.map((l,v)=>e.jsxs(R.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>Te(l),style:{background:"transparent",border:"none",padding:0,margin:0,cursor:"pointer",color:n.goldPrimary,fontWeight:500,fontSize:"13px",transition:"color 0.3s ease"},onMouseEnter:_=>{_.currentTarget.style.color=n.goldLight},onMouseLeave:_=>{_.currentTarget.style.color=n.goldPrimary},children:l}),v<a.actors.length-1&&e.jsx("span",{children:", "})]},l))]})]})})})}),extra:e.jsxs(G,{children:[e.jsx(ee,{title:"清理文件",children:e.jsx(se,{onClick:()=>Ne(o.hash),loading:z&&w===o.hash,children:e.jsx(be,{style:{fontSize:s.sizeLG,color:n.warning}})})}),e.jsx(ee,{title:"重新开始下载",children:e.jsx(se,{onClick:()=>{t.info("重新开始下载功能开发中...")},children:e.jsx(dn,{style:{fontSize:s.sizeLG,color:"#1890ff"}})})}),e.jsx(ee,{title:"暂停下载",children:e.jsx(se,{onClick:()=>{t.info("暂停下载功能开发中...")},children:e.jsx(gn,{style:{fontSize:s.sizeLG,color:"#faad14"}})})}),e.jsx(ee,{title:'标记为"整理成功"',children:e.jsx(se,{onClick:()=>{r.confirm({title:"是否确认标记为完成",onOk:()=>de(o.hash)})},children:e.jsx(Pn,{style:{fontSize:s.sizeLG,color:"#52c41a"}})})}),e.jsx(ee,{title:"删除任务",children:e.jsx(se,{onClick:()=>{r.confirm({title:"确认删除下载任务？",content:"此操作将删除下载任务，但不会删除已下载的文件",okText:"确认删除",okType:"danger",onOk:()=>{t.info("删除功能开发中...")}})},children:e.jsx(un,{style:{fontSize:s.sizeLG,color:"#ff4d4f"}})})})]})}));return e.jsxs(oe,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:n.textPrimary,fontSize:"18px",fontWeight:600},children:"下载列表"}),e.jsxs(G,{children:[e.jsx(ee,{title:"检查不符合过滤规则的文件",children:e.jsx(ae,{icon:e.jsx($e,{}),size:"small",onClick:xe,loading:Q,style:{background:n.bgContainer,borderColor:n.goldPrimary,color:n.goldPrimary,transition:"all 0.3s ease"},children:"快速检查"})}),e.jsx(ae,{icon:e.jsx(be,{}),size:"small",onClick:xe,loading:Q,style:{background:n.bgContainer,borderColor:n.warning,color:n.warning,transition:"all 0.3s ease"},children:"批量清理"}),e.jsxs(ae,{icon:e.jsx(yn,{}),size:"small",onClick:()=>I(!g),style:{background:n.bgContainer,borderColor:n.borderPrimary,color:n.textSecondary,transition:"all 0.3s ease"},children:["高级筛选 ",g?"▼":"▶"]}),e.jsx(ae,{icon:e.jsx(bn,{}),size:"small",onClick:K,loading:V,style:{background:"linear-gradient(135deg, #d4a852 0%, #e8c780 100%)",borderColor:n.goldPrimary,color:n.bgBase,fontWeight:600,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:"刷新"})]})]}),loading:V,extra:e.jsxs(G.Compact,{children:[e.jsx(mn,{value:h,onChange:o=>C(o.target.value),placeholder:"搜索",style:{background:n.bgContainer,borderColor:n.borderPrimary,color:n.textPrimary}}),e.jsx(ae,{icon:e.jsx($e,{}),style:{background:n.bgContainer,borderColor:n.borderPrimary,color:n.textSecondary}})]}),style:{background:n.bgElevated,borderColor:n.borderPrimary},styles:{header:{background:n.bgBase,borderBottom:"1px solid rgba(255, 255, 255, 0.08)"},body:{background:n.bgElevated}},children:[e.jsxs(ie,{gutter:16,style:{marginBottom:20},children:[e.jsx(L,{span:6,children:e.jsx(oe,{size:"small",style:{background:n.bgContainer,borderColor:n.borderPrimary,borderRadius:"8px"},styles:{body:{padding:"16px"}},children:e.jsx(ne,{title:e.jsx("span",{style:{color:n.textSecondary,fontSize:"14px"},children:"总任务数"}),value:S.length,valueStyle:{color:n.textPrimary,fontSize:"24px",fontWeight:600}})})}),e.jsx(L,{span:6,children:e.jsx(oe,{size:"small",style:{background:n.bgContainer,borderColor:n.borderPrimary,borderRadius:"8px"},styles:{body:{padding:"16px"}},children:e.jsx(ne,{title:e.jsx("span",{style:{color:n.textSecondary,fontSize:"14px"},children:"进行中"}),value:S.reduce((o,a)=>o+a.files.filter(l=>l.progress>0&&l.progress<1).length,0),valueStyle:{color:"#4facfe",fontSize:"24px",fontWeight:600}})})}),e.jsx(L,{span:6,children:e.jsx(oe,{size:"small",style:{background:n.bgContainer,borderColor:n.borderPrimary,borderRadius:"8px"},styles:{body:{padding:"16px"}},children:e.jsx(ne,{title:e.jsx("span",{style:{color:n.textSecondary,fontSize:"14px"},children:"已完成"}),value:S.reduce((o,a)=>o+a.files.filter(l=>l.progress>=1).length,0),valueStyle:{color:"#52c41a",fontSize:"24px",fontWeight:600}})})}),e.jsx(L,{span:6,children:e.jsx(oe,{size:"small",style:{background:n.bgContainer,borderColor:n.borderPrimary,borderRadius:"8px"},styles:{body:{padding:"16px"}},children:e.jsx(ne,{title:e.jsx("span",{style:{color:n.textSecondary,fontSize:"14px"},children:"失败/等待"}),value:S.reduce((o,a)=>o+a.files.filter(l=>l.progress===0).length,0),valueStyle:{color:"#ff7875",fontSize:"24px",fontWeight:600}})})})]}),e.jsx(hn,{}),e.jsx(pn,{type:"info",showIcon:!0,style:{marginBottom:16,background:n.bgContainer,borderColor:n.borderPrimary},message:"当前页面显示下载器实时任务；订阅页显示订阅历史记录，两者数据范围不同。"}),e.jsx("div",{style:{marginBottom:16,padding:"12px 16px",background:n.bgContainer,border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:"8px"},children:e.jsxs(ie,{gutter:16,children:[e.jsx(L,{children:e.jsxs(G,{children:[e.jsx("span",{style:{color:n.textSecondary,fontSize:"14px"},children:"显示已完成:"}),e.jsx(Ce,{checked:j,onChange:$,size:"small",style:{background:j?n.goldPrimary:"rgba(255, 255, 255, 0.2)"}})]})}),e.jsx(L,{children:e.jsxs(G,{children:[e.jsx("span",{style:{color:n.textSecondary,fontSize:"14px"},children:"显示失败:"}),e.jsx(Ce,{checked:p,onChange:d,size:"small",style:{background:p?n.goldPrimary:"rgba(255, 255, 255, 0.2)"}})]})})]})}),g&&e.jsx(oe,{size:"small",style:{marginBottom:16,background:n.bgContainer,borderColor:n.borderPrimary,borderRadius:"8px"},styles:{body:{padding:"16px",background:n.bgContainer}},children:e.jsxs(ie,{gutter:[16,8],children:[e.jsxs(L,{span:8,children:[e.jsx("div",{style:{marginBottom:8,color:n.textSecondary,fontSize:"14px",fontWeight:500},children:"状态筛选"}),e.jsxs(D,{value:c.status,onChange:o=>b({...c,status:o}),style:{width:"100%"},dropdownStyle:{background:n.bgContainer,borderColor:n.borderPrimary},children:[e.jsx(D.Option,{value:"all",children:"全部状态"}),e.jsx(D.Option,{value:"downloading",children:"下载中"}),e.jsx(D.Option,{value:"completed",children:"已完成"}),e.jsx(D.Option,{value:"failed",children:"失败/等待"})]})]}),e.jsxs(L,{span:8,children:[e.jsx("div",{style:{marginBottom:8,color:n.textSecondary,fontSize:"14px",fontWeight:500},children:"排序方式"}),e.jsxs(D,{value:`${c.sortBy}-${c.sortOrder}`,onChange:o=>{const[a,l]=o.split("-");b({...c,sortBy:a,sortOrder:l})},style:{width:"100%"},dropdownStyle:{background:n.bgContainer,borderColor:n.borderPrimary},children:[e.jsx(D.Option,{value:"date-desc",children:"添加时间 (新→旧)"}),e.jsx(D.Option,{value:"date-asc",children:"添加时间 (旧→新)"}),e.jsx(D.Option,{value:"progress-desc",children:"进度 (高→低)"}),e.jsx(D.Option,{value:"progress-asc",children:"进度 (低→高)"}),e.jsx(D.Option,{value:"size-desc",children:"大小 (大→小)"}),e.jsx(D.Option,{value:"size-asc",children:"大小 (小→大)"})]})]}),e.jsxs(L,{span:8,children:[e.jsx("div",{style:{marginBottom:8,color:n.textSecondary,fontSize:"14px",fontWeight:500},children:"快速操作"}),e.jsx(G,{children:e.jsx(ae,{size:"small",onClick:()=>{b({status:"all",sizeRange:[0,1e4],dateRange:null,sortBy:"date",sortOrder:"desc"}),C("")},style:{background:n.bgContainer,borderColor:n.borderPrimary,color:n.textSecondary},children:"重置筛选"})})]})]})}),Z.length>0?e.jsxs(e.Fragment,{children:[Z.length!==S.length&&e.jsx("div",{style:{marginBottom:16,padding:"12px 16px",background:n.bgContainer,border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:8},children:e.jsxs(G,{children:[e.jsx(je,{count:Z.length,style:{background:"linear-gradient(135deg, #d4a852 0%, #e8c780 100%)",color:n.bgBase,fontWeight:600,boxShadow:"0 2px 8px rgba(212, 168, 82, 0.3)"}}),e.jsxs("span",{style:{color:n.textSecondary,fontSize:"14px"},children:["筛选结果：",Z.length," / ",S.length," 个任务"]})]})}),e.jsx(Fn,{items:Le,ghost:!0})]}):S.length>0?e.jsx(ce,{description:"没有符合筛选条件的下载任务"}):e.jsx(ce,{description:e.jsxs("span",{children:["无下载任务，",e.jsx(fn,{to:"/setting/download",children:"配置下载"})]})}),e.jsx(Sn,{title:"下载整理",mode:"download",width:1100,path:m,open:!!m,onCancel:()=>x(void 0),onOk:()=>{x(void 0),K()}}),e.jsx(Se,{title:"清理文件预览",open:P,onOk:Me,onCancel:Oe,okText:"确认清理",cancelText:"取消",okButtonProps:{danger:!0,loading:z},width:800,styles:{body:{background:n.bgBase,maxHeight:"500px",overflowY:"auto"}},children:i&&e.jsxs("div",{style:{color:n.textPrimary},children:[e.jsx("div",{style:{marginBottom:16,padding:"12px 16px",background:n.bgContainer,borderRadius:"8px",border:"1px solid rgba(255, 255, 255, 0.08)"},children:e.jsxs(ie,{gutter:16,children:[e.jsxs(L,{span:12,children:[e.jsx("span",{style:{color:n.textSecondary},children:"将要删除的文件数："}),e.jsx("span",{style:{color:"#ff4d4f",fontWeight:600,marginLeft:8},children:((he=i.files_to_delete)==null?void 0:he.length)||0})]}),e.jsxs(L,{span:12,children:[e.jsx("span",{style:{color:n.textSecondary},children:"预计释放空间："}),e.jsx("span",{style:{color:"#52c41a",fontWeight:600,marginLeft:8},children:i.deleted_size_mb?`${i.deleted_size_mb} MB`:"0 MB"})]})]})}),i.files_to_delete&&i.files_to_delete.length>0?e.jsx(U,{dataSource:i.files_to_delete,renderItem:o=>e.jsx(U.Item,{style:{background:n.bgElevated,borderRadius:"8px",padding:"12px 16px",marginBottom:"8px",border:"1px solid rgba(255, 255, 255, 0.08)"},children:e.jsx(U.Item.Meta,{title:e.jsx("span",{style:{color:n.textPrimary},children:o.name}),description:e.jsxs("div",{children:[e.jsx("div",{style:{color:n.textTertiary,fontSize:"13px"},children:o.path}),e.jsxs(G,{style:{marginTop:4},children:[e.jsx(le,{style:{background:"rgba(255, 77, 79, 0.2)",borderColor:"#ff4d4f",color:"#ff4d4f"},children:o.size}),o.reason&&e.jsx(le,{style:{background:"rgba(250, 173, 20, 0.2)",borderColor:n.warning,color:n.warning},children:o.reason})]})]})})})}):e.jsx(ce,{description:"没有需要清理的文件",style:{color:n.textSecondary}})]})}),e.jsx(Se,{title:"不符合过滤规则的文件预览",open:E,onOk:_e,onCancel:Ae,okText:"确认清理",cancelText:"取消",okButtonProps:{danger:!0,loading:Q},width:900,styles:{body:{background:n.bgBase,maxHeight:"600px",overflowY:"auto"}},children:W&&e.jsxs("div",{style:{color:n.textPrimary},children:[e.jsx("div",{style:{marginBottom:16,padding:"16px",background:n.bgContainer,borderRadius:"8px",border:"1px solid rgba(255, 255, 255, 0.08)"},children:e.jsxs(ie,{gutter:16,children:[e.jsx(L,{span:8,children:e.jsx(ne,{title:e.jsx("span",{style:{color:n.textSecondary},children:"将要清理的种子数"}),value:O.length,valueStyle:{color:n.goldPrimary,fontWeight:600}})}),e.jsx(L,{span:8,children:e.jsx(ne,{title:e.jsx("span",{style:{color:n.textSecondary},children:"总共要删除的文件数"}),value:W.total_deleted_files||0,valueStyle:{color:"#ff4d4f",fontWeight:600}})}),e.jsx(L,{span:8,children:e.jsx(ne,{title:e.jsx("span",{style:{color:n.textSecondary},children:"预计释放空间"}),value:(W.total_deleted_size_mb||0)/1024,precision:2,suffix:"GB",valueStyle:{color:"#52c41a",fontWeight:600}})})]})}),O.length>0?e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:12,color:n.textSecondary,fontSize:"14px",fontWeight:500},children:"详细清理列表："}),e.jsx(U,{dataSource:O,renderItem:(o,a)=>e.jsx(U.Item,{style:{background:n.bgElevated,borderRadius:"8px",padding:"12px 16px",marginBottom:"8px",border:"1px solid rgba(255, 255, 255, 0.08)"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[e.jsx(je,{count:a+1,style:{background:n.goldPrimary,marginRight:8}}),e.jsx("span",{style:{color:n.textPrimary,fontWeight:500,fontSize:"14px"},children:o.name||"未知种子"}),e.jsxs(le,{style:{marginLeft:"auto",background:"rgba(255, 77, 79, 0.2)",borderColor:"#ff4d4f",color:"#ff4d4f"},children:[o.deleted_files||0," 个文件"]})]}),e.jsx("div",{style:{paddingLeft:32,color:n.textTertiary,fontSize:"13px"},children:o.message||"无详情"})]})})})]}):e.jsx(ce,{description:"没有需要批量清理的文件",style:{color:n.textSecondary}})]})})]})}export{Qn as component};
