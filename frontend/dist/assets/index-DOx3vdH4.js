import{aL as b,aM as w,aA as h,r as l,F as e,au as S,a6 as I,U as C,as as M,O,ap as R,N as n,b8 as z,aS as N,b9 as D,aU as T}from"./index-DN2Bw1AB.js";import{u as q}from"./index-bV0i9UMV.js";import{M as A}from"./index-CGfWKnnD.js";import{V as H}from"./index-J1YqMbnw.js";import"./index-DU-NLy02.js";async function W(){return(await b.request({url:"/history/",method:"get"})).data}function B(d){return b.request({url:"/history/",method:"delete",params:{history_id:d}})}function $(){const{message:d,modal:m}=w.useApp(),{data:c=[],loading:f,refresh:u}=h(W,{}),[t,i]=l.useState(),[x,g]=l.useState(),o=q(x,{wait:1e3}),y=l.useMemo(()=>c.filter(a=>{var r,s,p;return!o||((r=a.num)==null?void 0:r.indexOf(o))>-1||((s=a.source_path)==null?void 0:s.indexOf(o))>-1||((p=a.dest_path)==null?void 0:p.indexOf(o))>-1}),[c,o]),{run:j}=h(B,{manual:!0,onSuccess:()=>{u(),d.success("删除成功")}}),k=[{title:"状态",dataIndex:"status",render:a=>a?e.jsx(n,{style:{background:"rgba(212, 168, 82, 0.1)",border:"1px solid rgba(212, 168, 82, 0.3)",color:"#d4a852"},children:"成功"}):e.jsx(n,{style:{background:"rgba(255, 77, 79, 0.1)",border:"1px solid rgba(255, 77, 79, 0.3)",color:"#ff4d4f"},children:"失败"})},{title:"番号",dataIndex:"num",render:(a,r)=>e.jsxs("div",{children:[e.jsx("b",{style:{color:"#f0f0f2"},children:a}),e.jsxs("div",{style:{marginTop:4},children:[r.is_zh&&e.jsx(n,{style:{background:"rgba(212, 168, 82, 0.12)",border:"1px solid rgba(212, 168, 82, 0.25)",color:"#e8c780",marginRight:4},children:"中文"}),r.is_uncensored&&e.jsx(n,{style:{background:"rgba(212, 168, 82, 0.12)",border:"1px solid rgba(212, 168, 82, 0.25)",color:"#e8c780"},children:"无码"})]})]})},{title:"路径",dataIndex:"path",render:(a,r)=>e.jsxs("div",{style:{WebkitTextSizeAdjust:"100%",fontSize:13,maxWidth:680,color:"#a0a0a8",lineHeight:"1.6"},children:[e.jsx("div",{style:{marginBottom:4},children:r.source_path}),e.jsx("div",{style:{color:"#d4a852",fontSize:12,margin:"6px 0"},children:"⟹"}),e.jsx("div",{children:r.dest_path})]})},{title:"转移方式",dataIndex:"trans_method",render:a=>{const r=z.find(s=>s.value===a);return e.jsx(n,{style:{background:"rgba(212, 168, 82, 0.1)",border:"1px solid rgba(212, 168, 82, 0.3)",color:"#d4a852"},children:r==null?void 0:r.name})}},{title:"时间",dataIndex:"create_time",render:a=>e.jsx("span",{style:{color:"#a0a0a8",fontSize:13},children:N(a).format("lll")})},{title:"",dataIndex:"operations",width:20,fixed:"right",render:(a,r)=>!r.is_admin&&e.jsx(A,{items:_,onClick:s=>v(s,r)})}],_=[{key:"edit",label:"重新整理",icon:e.jsx(D,{})},{key:"delete",label:"删除记录",icon:e.jsx(T,{})}];function v(a,r){a==="edit"?i(r):a==="delete"&&m.confirm({title:"是否确认删除记录",onOk:()=>{j(r.id)}})}return e.jsx("div",{className:"history-page-wrapper animate-fade-in",children:e.jsxs(S,{title:e.jsx("span",{style:{color:"#f0f0f2",fontSize:18,fontWeight:500},children:"历史记录"}),className:"dark-card",style:{background:"#141416",border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:8},extra:e.jsxs(C.Compact,{children:[e.jsx(M,{value:x,onChange:a=>g(a.target.value),placeholder:"搜索番号或路径",style:{background:"#1a1a1d",border:"1px solid rgba(255, 255, 255, 0.08)",color:"#f0f0f2"},className:"dark-input"}),e.jsx(O,{icon:e.jsx(R,{}),style:{background:"#1a1a1d",border:"1px solid rgba(255, 255, 255, 0.08)",color:"#d4a852"}})]}),children:[e.jsx(I,{rowKey:"id",scroll:{x:"max-content"},columns:k,loading:f,dataSource:y,className:"dark-table",rowClassName:"dark-table-row",style:{background:"transparent"}}),e.jsx(H,{title:"重新整理",mode:"history",transMode:t!=null&&t.status?"move":t==null?void 0:t.trans_mode,width:1100,path:t!=null&&t.status?t==null?void 0:t.dest_path:t==null?void 0:t.source_path,open:!!t,onCancel:()=>i(void 0),onOk:()=>{i(void 0),u()}})]})})}export{$ as component};
