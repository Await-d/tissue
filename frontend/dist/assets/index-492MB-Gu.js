import{as as n,r as g,F as e,ak as C,U as D,bq as k,br as R,aj as q,at as d,O as m,ae as f,T as V,b6 as B,aP as w,aB as v,bs as N,bt as A,bu as L,bv as U,bw as W,a4 as $,R as F,G as o,bx as G,by as H,bk as J,au as T,al as K}from"./index-CIppsPuS.js";const Q="_form_1f6j5_1",X={form:Q};function Y(u){const{data:s,onOk:r,onDelete:h,onCancel:a,...c}=u,[t]=n.useForm(),[j,p]=g.useState(s==null?void 0:s.thumb);g.useEffect(()=>{u.open?(t.setFieldsValue(s),p(s==null?void 0:s.thumb)):(t.resetFields(),p(void 0))},[u.open,s]);function i(b){r==null||r(b)}const x=b=>{const I=b.target.value;p(I)},y=()=>{f.error("头像链接无效，请检查URL是否正确")};return e.jsx(C,{title:s?"修改演员信息":"添加新演员",...c,width:420,onCancel:a,footer:[s&&e.jsx(m,{danger:!0,onClick:h,children:"删除"},"delete"),e.jsx(m,{onClick:a,children:"取消"},"cancel"),e.jsx(m,{type:"primary",onClick:()=>t.submit(),children:"确定"},"submit")],children:e.jsxs(n,{form:t,layout:"vertical",onFinish:i,initialValues:s,children:[e.jsxs(D,{direction:"vertical",style:{width:"100%",display:"flex",alignItems:"center",marginBottom:24},children:[e.jsx(k,{size:80,icon:e.jsx(q,{}),src:j&&R(j),onError:()=>(y(),!0),style:{border:"2px solid #f0f0f0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:8},children:j?"预览头像":"暂无头像"})]}),e.jsx(n.Item,{name:"name",label:"演员姓名",rules:[{required:!0,message:"请输入演员姓名"}],children:e.jsx(d,{placeholder:"请输入演员姓名"})}),e.jsx(n.Item,{name:"thumb",label:"头像链接",extra:"输入完整的图片URL或相对路径",children:e.jsx(d,{placeholder:"请输入头像链接",onChange:x})})]})})}function Z(u){const{value:s,onChange:r}=u,[h,a]=g.useState(void 0),[c,t]=g.useState(void 0);function j(i){if(h==="add"){if(s!=null&&s.some(x=>x.name===i.name))return f.error("该演员已存在");r==null||r([...s||[],i])}else h=="edit"&&(s[c]=i,r==null||r(s&&[...s]));a(void 0),t(void 0)}function p(){r==null||r(s==null?void 0:s.filter((i,x)=>x!=c)),a(void 0),t(void 0)}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(V.Title,{level:5,style:{marginBottom:12},children:"演员信息"}),s&&s.length>0?e.jsx(D,{direction:"vertical",style:{width:"100%"},children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:12},children:[s.map((i,x)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[e.jsx(k,{style:{cursor:"pointer",border:"2px solid #f0f0f0",transition:"all 0.3s"},size:64,src:(i==null?void 0:i.thumb)&&R(i.thumb),onClick:()=>{a("edit"),t(x)}}),e.jsx(V.Text,{style:{marginTop:4,maxWidth:64,textAlign:"center",fontSize:12},ellipsis:{tooltip:i==null?void 0:i.name},children:i==null?void 0:i.name}),e.jsx(m,{size:"small",type:"text",icon:e.jsx(B,{}),style:{position:"absolute",top:-8,right:-8,background:"#fff",borderRadius:"50%",border:"1px solid #f0f0f0",padding:0,height:24,width:24,display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>{a("edit"),t(x)}})]},i.name)),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(k,{style:{cursor:"pointer",backgroundColor:"#fafafa",border:"1px dashed #d9d9d9",display:"flex",justifyContent:"center",alignItems:"center",transition:"all 0.3s",color:"#999"},size:64,icon:e.jsx(w,{}),onClick:()=>{a("add"),t(void 0)}}),e.jsx(V.Text,{style:{marginTop:4,fontSize:12},children:"添加演员"})]})]})}):e.jsx(m,{icon:e.jsx(w,{}),onClick:()=>{a("add"),t(void 0)},children:"添加演员"})]}),e.jsx(Y,{data:c!=null&&s&&s[c],open:!!h,onOk:j,onCancel:()=>a(void 0),onDelete:p})]})}function ee(u){const{path:s,mode:r,transMode:h,onOk:a,...c}=u,[t]=n.useForm(),{run:j,loading:p}=v(E,{manual:!0,onSuccess:l=>{t.setFieldsValue(l)}}),{run:i,loading:x}=v(N,{manual:!0,onSuccess:l=>{delete l.data.data.is_zh,delete l.data.data.is_uncensored,t.setFieldsValue(l.data.data),f.success("刮削成功")}}),{run:y,loading:b}=v(A,{manual:!0,onSuccess:l=>{f.success("保存成功"),a==null||a(l.request.data)}}),{run:I,loading:z}=v(L,{manual:!0,onSuccess:l=>{f.success("删除成功"),a==null||a(l.request.data)}});async function E(l){let S=await U(l);return S.num||(S=await W(l)),S}function _(){const l=t.getFieldValue("num");return l?i(l):f.error("请输入番号")}function M(l){return l.path=s,y(l,r,h)}function P(){C.confirm({title:"是否确认删除",onOk:()=>{I(s)}})}return g.useEffect(()=>{c.open&&s?j(s):t.resetFields()},[c.open]),e.jsx(C,{...c,footer:[r==="video"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{onClick:P,danger:!0,loading:z,children:"删除"}),e.jsx(K,{type:"vertical"})]}),e.jsx(m,{onClick:_,loading:x,children:"刮削"},"scrape"),e.jsx(m,{type:"primary",loading:b,onClick:()=>t.submit(),children:"确定"},"save")],children:p?e.jsx("div",{className:"text-center",children:e.jsx($,{spinning:!0})}):e.jsx(n,{className:X.form,form:t,layout:"vertical",onFinish:M,children:e.jsxs(F,{gutter:[30,15],children:[e.jsxs(o,{span:24,md:10,lg:10,children:[e.jsx(n.Item,{noStyle:!0,name:"cover",children:e.jsx(G,{})}),e.jsx("br",{}),e.jsx(n.Item,{label:"演员",name:"actors",children:e.jsx(Z,{})}),e.jsx("br",{}),e.jsx(n.Item,{label:"网站",name:"website",children:e.jsx(H,{})})]}),e.jsx(o,{span:24,md:14,lg:14,children:e.jsxs(F,{gutter:[15,15],children:[e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"num",label:"番号",rules:[{required:!0,message:"请输入番号"}],children:e.jsx(d,{})})}),e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"premiered",label:"发行时间",children:e.jsx(d,{})})}),e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"rating",label:"评分",children:e.jsx(d,{})})}),e.jsx(o,{span:24,children:e.jsx(n.Item,{name:"title",label:"标题",children:e.jsx(d,{})})}),e.jsx(o,{span:24,children:e.jsx(n.Item,{name:"outline",label:"大纲",children:e.jsx(d.TextArea,{})})}),e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"studio",label:"制造商",children:e.jsx(d,{})})}),e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"publisher",label:"发行商",children:e.jsx(d,{})})}),e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"director",label:"导演",children:e.jsx(d,{})})}),e.jsx(o,{span:24,children:e.jsx(n.Item,{name:"tags",label:"类别",children:e.jsx(J,{mode:"tags"})})}),e.jsx(o,{span:12,children:e.jsx(n.Item,{name:"series",label:"系列",children:e.jsx(d,{})})}),e.jsx(o,{span:12,children:e.jsx(n.Item,{name:"runtime",label:"时长(分钟)",children:e.jsx(d,{})})}),e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"is_zh",label:"是否中文",valuePropName:"checked",initialValue:!1,children:e.jsx(T,{})})}),e.jsx(o,{span:8,children:e.jsx(n.Item,{name:"is_uncensored",label:"是否无码",valuePropName:"checked",initialValue:!1,children:e.jsx(T,{})})})]})})]})})})}export{ee as V};
