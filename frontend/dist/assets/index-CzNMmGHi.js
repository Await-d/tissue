import{aM as p,W as w,aN as C,aB as g,r as l,F as r,av as I,a7 as P,U as $,at as M,O as N,aq as O,N as d,ba as R,aT as T,bb as z,aV as q}from"./index-BL2fqrZk.js";import{u as D}from"./index-BJAkDLsx.js";import{M as H}from"./index-CtwhS2a-.js";import{V as W}from"./index-C5sSq0-7.js";import"./index-CMHnGFFk.js";async function A(){return await p.request({url:"/history/",method:"get"})}function B(e){return p.request({url:"/history/",method:"delete",params:{history_id:e}})}function L(){const e=w(),{message:b,modal:h}=C.useApp(),{data:c=[],loading:y,refresh:u}=g(A,{}),[a,i]=l.useState(),[x,f]=l.useState(),n=D(x,{wait:1e3}),j=l.useMemo(()=>c.filter(o=>{var t,s,m;return!n||((t=o.num)==null?void 0:t.indexOf(n))>-1||((s=o.source_path)==null?void 0:s.indexOf(n))>-1||((m=o.dest_path)==null?void 0:m.indexOf(n))>-1}),[c,n]),{run:k}=g(B,{manual:!0,onSuccess:()=>{u(),b.success("删除成功")}}),v=[{title:"状态",dataIndex:"status",render:o=>o?r.jsx(d,{style:{background:e.rgba("gold",.1),border:`1px solid ${e.borderGold}`,color:e.goldPrimary},children:"成功"}):r.jsx(d,{style:{background:e.rgba("red",.1),border:"1px solid rgba(255, 77, 79, 0.3)",color:"#ff4d4f"},children:"失败"})},{title:"番号",dataIndex:"num",render:(o,t)=>r.jsxs("div",{children:[r.jsx("b",{style:{color:e.textPrimary},children:o}),r.jsxs("div",{style:{marginTop:4},children:[t.is_zh&&r.jsx(d,{style:{background:e.rgba("gold",.12),border:`1px solid ${e.rgba("gold",.25)}`,color:e.goldLight,marginRight:4},children:"中文"}),t.is_uncensored&&r.jsx(d,{style:{background:e.rgba("gold",.12),border:`1px solid ${e.rgba("gold",.25)}`,color:e.goldLight},children:"无码"})]})]})},{title:"路径",dataIndex:"path",render:(o,t)=>r.jsxs("div",{style:{WebkitTextSizeAdjust:"100%",fontSize:13,maxWidth:680,color:e.textSecondary,lineHeight:"1.6"},children:[r.jsx("div",{style:{marginBottom:4},children:t.source_path}),r.jsx("div",{style:{color:e.goldPrimary,fontSize:12,margin:"6px 0"},children:"⟹"}),r.jsx("div",{children:t.dest_path})]})},{title:"转移方式",dataIndex:"trans_method",render:o=>{const t=R.find(s=>s.value===o);return r.jsx(d,{style:{background:e.rgba("gold",.1),border:`1px solid ${e.borderGold}`,color:e.goldPrimary},children:t==null?void 0:t.name})}},{title:"时间",dataIndex:"create_time",render:o=>r.jsx("span",{style:{color:e.textSecondary,fontSize:13},children:T(o).format("lll")})},{title:"",dataIndex:"operations",width:20,fixed:"right",render:(o,t)=>!t.is_admin&&r.jsx(H,{items:_,onClick:s=>S(s,t)})}],_=[{key:"edit",label:"重新整理",icon:r.jsx(z,{})},{key:"delete",label:"删除记录",icon:r.jsx(q,{})}];function S(o,t){o==="edit"?i(t):o==="delete"&&h.confirm({title:"是否确认删除记录",onOk:()=>{k(t.id)}})}return r.jsx("div",{className:"history-page-wrapper animate-fade-in",children:r.jsxs(I,{title:r.jsx("span",{style:{color:e.textPrimary,fontSize:18,fontWeight:500},children:"历史记录"}),className:"dark-card",style:{background:e.bgElevated,border:`1px solid ${e.borderPrimary}`,borderRadius:8},extra:r.jsxs($.Compact,{children:[r.jsx(M,{value:x,onChange:o=>f(o.target.value),placeholder:"搜索番号或路径",style:{background:e.bgContainer,border:`1px solid ${e.borderPrimary}`,color:e.textPrimary},className:"dark-input"}),r.jsx(N,{icon:r.jsx(O,{}),style:{background:e.bgContainer,border:`1px solid ${e.borderPrimary}`,color:e.goldPrimary}})]}),children:[r.jsx(P,{rowKey:"id",scroll:{x:"max-content"},columns:v,loading:y,dataSource:j,className:"dark-table",rowClassName:"dark-table-row",style:{background:"transparent"}}),r.jsx(W,{title:"重新整理",mode:"history",transMode:a!=null&&a.status?"move":a==null?void 0:a.trans_mode,width:1100,path:a!=null&&a.status?a==null?void 0:a.dest_path:a==null?void 0:a.source_path,open:!!a,onCancel:()=>i(void 0),onOk:()=>{i(void 0),u()}})]})})}export{L as component};
