#!/bin/bash

groupmod -o -g ${PGID} tissue-plus
usermod -o -u ${PUID} tissue-plus

chown -R tissue-plus:tissue-plus /app

umask ${UMASK}

nginx -g "daemon off;" &

# è¿è¡Œå¯åŠ¨æ£€æŸ¥å’Œä¿®å¤è„šæœ¬
echo "ğŸš€ æ­£åœ¨è¿›è¡Œå¯åŠ¨æ£€æŸ¥å’Œä¿®å¤..."
if python startup_check.py; then
    echo "âœ… å¯åŠ¨æ£€æŸ¥å®Œæˆï¼Œæ‰€æœ‰æ£€æŸ¥é€šè¿‡"
else
    echo "âš ï¸ å¯åŠ¨æ£€æŸ¥å‘ç°é—®é¢˜ï¼Œå·²å°è¯•è‡ªåŠ¨ä¿®å¤"
    echo "ğŸ“‹ è¯¦ç»†æŠ¥å‘Šè¯·æŸ¥çœ‹ startup_check_report.txt"
fi

# å¯åŠ¨åº”ç”¨
echo "ğŸŒŸ å¯åŠ¨åº”ç”¨æœåŠ¡..."
gosu tissue-plus:tissue-plus uvicorn app.main:app --host 0.0.0.0 --port 9193 --log-level warning