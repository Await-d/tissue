import{as as u,F as e,ak as V,at as B,au as M,U as R,O as F,aB as z,r as d,R as k,G as b,av as h,S as w,N as m,aC as I,aD as T,Z as W,ab as P,W as S,aE as D,az as L,aF as U}from"./index-DRuZORCc.js";import{V as _}from"./index-DUcdU-GH.js";function $(o){const{onFilter:x,actors:f=[],initialValues:j,...p}=o,[a]=u.useForm();async function g(){const n=await a.validateFields();x(n)}function c(){a.resetFields(),x({})}const r=f.map(n=>({label:`${n.name}(${n.count}部)`,value:n.name}));return e.jsx(V,{title:"影片过滤",...p,footer:e.jsxs(R,{children:[e.jsx(F,{onClick:c,children:"重 制"}),e.jsx(F,{type:"primary",onClick:g,children:"确 定"})]}),children:e.jsxs(u,{form:a,layout:"vertical",initialValues:j,children:[e.jsx(u.Item,{name:"title",label:"标题",children:e.jsx(B,{allowClear:!0})}),e.jsx(u.Item,{name:"actors",label:"演员",children:e.jsx(M.Group,{options:r})})]})})}function N(){var C;const{data:o=[],loading:x,run:f,refresh:j}=z(U),[p,a]=d.useState(),[g,c]=d.useState(!1),[r,n]=d.useState({}),E=d.useMemo(()=>{const t=[];return o.forEach(s=>{s.actors.forEach(l=>{const i=t.find(O=>O.name==l.name);i?i.count=i.count+1:(l.count=1,t.push(l))})}),t},[o]),v=d.useMemo(()=>o.filter(t=>{var s;return r.title&&!t.title.toUpperCase().includes(r.title.toUpperCase())?!1:(s=r.actors)!=null&&s.length?t.actors.map(l=>l.name).filter(l=>{var i;return(i=r.actors)==null?void 0:i.includes(l)}).length>0:!0}),[r,o]),y=!!r.title||!!((C=r.actors)!=null&&C.length);return x?e.jsx(k,{gutter:[15,15],children:[...Array(8)].map((t,s)=>e.jsx(b,{span:24,md:12,lg:6,children:e.jsxs(h,{children:[e.jsx(w.Image,{active:!0,style:{width:"100%",height:"200px",marginBottom:"12px"}}),e.jsx(w,{active:!0,paragraph:{rows:2}})]})},s))}):e.jsxs(k,{gutter:[15,15],children:[v.length>0?v.map(t=>e.jsx(b,{span:24,md:12,lg:6,children:e.jsx(h,{hoverable:!0,size:"small",cover:e.jsx(I,{src:t.cover}),onClick:()=>a(t.path),style:{transition:"all 0.3s",cursor:"pointer"},onMouseEnter:s=>{s.currentTarget.style.transform="translateY(-4px)",s.currentTarget.style.boxShadow="0 12px 24px rgba(0,0,0,0.15)"},onMouseLeave:s=>{s.currentTarget.style.transform="translateY(0)",s.currentTarget.style.boxShadow=""},children:e.jsx(h.Meta,{title:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"1.4",minHeight:"2.8em",fontSize:"14px",fontWeight:600},children:t.title}),description:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginTop:"8px"},children:[t.is_zh&&e.jsx(m,{color:"blue",bordered:!1,children:"中文"}),t.is_uncensored&&e.jsx(m,{color:"green",bordered:!1,children:"无码"}),t.actors.slice(0,3).map(s=>e.jsx(m,{color:"purple",bordered:!1,children:s.name},s.name)),t.actors.length>3&&e.jsxs(m,{color:"default",bordered:!1,children:["+",t.actors.length-3]})]})})})},t.path)):e.jsx(b,{span:24,children:e.jsx(h,{title:"视频",children:e.jsx(T,{description:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"16px",marginBottom:"8px"},children:y?"没有找到符合条件的视频":"暂无视频"}),e.jsx("div",{style:{fontSize:"14px",color:"#999"},children:y?"请尝试调整筛选条件":e.jsxs("span",{children:["请先 ",e.jsx(W,{to:"/setting",hash:"video",style:{fontWeight:500},children:"配置视频路径"})," 以添加视频"]})})]})})})}),e.jsx(_,{title:"编辑",mode:"video",width:1100,path:p,open:!!p,onCancel:()=>a(void 0),onOk:()=>{a(void 0),j()}}),e.jsx($,{open:g,actors:E,initialValues:r,onCancel:()=>c(!1),onFilter:t=>{n(t),c(!1)}}),e.jsx(e.Fragment,{children:P.createPortal(e.jsxs(e.Fragment,{children:[e.jsx(S,{icon:e.jsx(D,{}),onClick:()=>f(!0)}),e.jsx(S,{icon:e.jsx(L,{}),type:y?"primary":"default",onClick:()=>c(!0)})]}),document.getElementsByClassName("index-float-button-group")[0])})]})}export{N as component};
