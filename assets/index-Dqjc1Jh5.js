import{r,I as F,_ as P,ah as U,aB as u,aQ as V,aR as H,aS as E,F as e,am as T,J as C,aT as q,aC as O,U as S,aU as m,O as j,aq as w,aV as A,ag as M,aN as L,$ as Y,aW as G,aO as J,aX as Q,aY as W,av as h,S as X,R as I,G as R,at as Z,N as p,V as K,aD as ee,aZ as se,ad as ae,Y as z,aP as te,a_ as re}from"./index-DKw52thj.js";var ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},ce=function(c,i){return r.createElement(F,P({},c,{ref:i,icon:ne}))},ie=r.forwardRef(ce);function le(t){const{onResubscribe:c,...i}=t,b=U(),{data:l,loading:o,run:x,refresh:d}=u(V,{manual:!0}),{loading:g,run:n}=u(H,{manual:!0,onSuccess:()=>{M.success("重新订阅成功"),c()}}),{loading:f,run:v}=u(E,{manual:!0,onSuccess:()=>{M.success("订阅历史删除成功"),d()}});return r.useEffect(()=>{t.open&&x()},[t.open]),e.jsx(T,{title:"订阅历史",width:800,footer:null,loading:o,...i,children:e.jsx(C,{dataSource:l,itemLayout:"horizontal",renderItem:a=>e.jsxs("div",{className:"relative group",children:[e.jsx(C.Item,{children:e.jsx(C.Item.Meta,{avatar:e.jsx("div",{className:"w-24",children:e.jsx(O,{src:a.cover})}),title:e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.title}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.actors}),e.jsx("div",{className:"text-xs mt-0.5",children:q(a.update_time).fromNow()})]})})}),e.jsx("div",{className:"absolute inset-0 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity duration-500 flex justify-center items-center",children:e.jsxs(S,{size:"large",children:[e.jsx(m,{title:"搜索",children:e.jsx(j,{size:"large",icon:e.jsx(w,{}),type:"primary",shape:"circle",onClick:()=>{b.navigate({to:"/search",search:{num:a.num}})}})}),e.jsx(m,{title:"重新订阅",children:e.jsx(j,{size:"large",icon:e.jsx(ie,{}),type:"primary",shape:"circle",loading:g,onClick:()=>n(a.id)})}),e.jsx(m,{title:"删除历史",children:e.jsx(j,{size:"large",icon:e.jsx(A,{}),type:"primary",danger:!0,shape:"circle",loading:f,onClick:()=>v(a.id)})})]})})]})})})}function de(){const{message:t}=L.useApp(),c=Y(),{data:i=[],loading:b,refresh:l}=u(G,{}),[o,x]=r.useState(),[d,g]=r.useState(""),{setOpen:n,modalProps:f}=J({service:Q,onOk:()=>{n(!1),l()}}),[v,a]=r.useState(!1),{run:D}=u(E,{manual:!0,onSuccess:()=>{t.success("删除成功"),n(!1),l()}}),N=i.filter(s=>o?s.title.toUpperCase().includes(o.toUpperCase())||s.num.toUpperCase().includes(o.toUpperCase()):!0),{statusMap:_,error:y}=W(N);return r.useEffect(()=>{y&&t.warning(`下载状态检测失败: ${y.message}`)},[y,t]),b?e.jsx(h,{className:"subscribe-loading-card",children:e.jsx(X,{active:!0})}):e.jsxs("div",{className:"subscribe-container",children:[e.jsx(I,{children:e.jsx(R,{span:24,lg:{span:6,offset:18},children:e.jsxs(S.Compact,{className:"subscribe-search-bar",children:[e.jsx(Z,{allowClear:!0,value:d,onChange:s=>g(s.target.value),onPressEnter:()=>x(d),placeholder:"搜索番号或标题"}),e.jsx(j,{icon:e.jsx(w,{}),onClick:()=>x(d),className:"subscribe-search-btn"})]})})}),e.jsx(I,{gutter:[15,15],children:N.length>0?N.map(s=>{const $=_[s.num]||!1,k=e.jsx(h,{hoverable:!0,size:"small",className:"subscribe-card",cover:e.jsx(O,{src:s.cover}),onClick:()=>n(!0,s),children:e.jsx(h.Meta,{title:e.jsx("div",{className:"subscribe-card-title",children:s.title||s.num}),description:e.jsxs("div",{className:"flex",children:[e.jsxs(S,{size:[0,"small"],wrap:!0,className:"flex-1",children:[s.premiered&&e.jsx(p,{className:"subscribe-tag subscribe-tag-date",children:s.premiered}),s.is_hd&&e.jsx(p,{className:"subscribe-tag subscribe-tag-hd",children:"高清"}),s.is_zh&&e.jsx(p,{className:"subscribe-tag subscribe-tag-zh",children:"中文"}),s.is_uncensored&&e.jsx(p,{className:"subscribe-tag subscribe-tag-uncensored",children:"无码"})]}),e.jsx(m,{title:"搜索",children:e.jsx("div",{className:"subscribe-search-icon",onClick:B=>(B.stopPropagation(),c({to:"/search",search:{num:s.num}})),children:e.jsx(w,{})})})]})})});return e.jsx(R,{span:24,md:12,lg:6,children:$?e.jsx(K.Ribbon,{text:"已下载",color:"green",children:k}):k},s.id)}):e.jsx(R,{span:24,children:e.jsx(h,{className:"subscribe-empty-card",children:e.jsx(ee,{description:"无订阅",className:"subscribe-empty"})})})}),e.jsx(se,{width:1100,onDelete:D,...f}),e.jsx(le,{open:v,onCancel:()=>a(!1),onResubscribe:()=>{l(),a(!1)}}),e.jsx(e.Fragment,{children:ae.createPortal(e.jsxs(e.Fragment,{children:[e.jsx(z,{icon:e.jsx(te,{}),type:"primary",onClick:()=>n(!0),className:"subscribe-float-btn"}),e.jsx(z,{icon:e.jsx(re,{}),onClick:()=>a(!0),className:"subscribe-float-btn"})]}),document.getElementsByClassName("index-float-button-group")[0])})]})}export{de as component};
