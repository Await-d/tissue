import{r as c,I as F,_ as P,ah as U,aB as u,aQ as _,aR as $,aS as M,F as e,am as B,J as N,aT as D,aC as z,U as C,aU as m,O as j,aq as R,aV as H,ag as k,aN as V,$ as T,aW as q,aO as A,aX as L,av as h,S as Y,R as w,G as y,at as G,N as p,aD as J,aY as Q,ad as W,Y as I,aP as X,aZ as Z}from"./index-g83hHc8K.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},ee=function(n,i){return c.createElement(F,P({},n,{ref:i,icon:K}))},se=c.forwardRef(ee);function ae(t){const{onResubscribe:n,...i}=t,b=U(),{data:l,loading:o,run:x,refresh:d}=u(_,{manual:!0}),{loading:g,run:r}=u($,{manual:!0,onSuccess:()=>{k.success("重新订阅成功"),n()}}),{loading:f,run:v}=u(M,{manual:!0,onSuccess:()=>{k.success("订阅历史删除成功"),d()}});return c.useEffect(()=>{t.open&&x()},[t.open]),e.jsx(B,{title:"订阅历史",width:800,footer:null,loading:o,...i,children:e.jsx(N,{dataSource:l,itemLayout:"horizontal",renderItem:a=>e.jsxs("div",{className:"relative group",children:[e.jsx(N.Item,{children:e.jsx(N.Item.Meta,{avatar:e.jsx("div",{className:"w-24",children:e.jsx(z,{src:a.cover})}),title:e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.title}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-nowrap overflow-hidden text-ellipsis",children:a.actors}),e.jsx("div",{className:"text-xs mt-0.5",children:D(a.update_time).fromNow()})]})})}),e.jsx("div",{className:"absolute inset-0 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity duration-500 flex justify-center items-center",children:e.jsxs(C,{size:"large",children:[e.jsx(m,{title:"搜索",children:e.jsx(j,{size:"large",icon:e.jsx(R,{}),type:"primary",shape:"circle",onClick:()=>{b.navigate({to:"/search",search:{num:a.num}})}})}),e.jsx(m,{title:"重新订阅",children:e.jsx(j,{size:"large",icon:e.jsx(se,{}),type:"primary",shape:"circle",loading:g,onClick:()=>r(a.id)})}),e.jsx(m,{title:"删除历史",children:e.jsx(j,{size:"large",icon:e.jsx(H,{}),type:"primary",danger:!0,shape:"circle",loading:f,onClick:()=>v(a.id)})})]})})]})})})}function re(){const{message:t}=V.useApp(),n=T(),{data:i=[],loading:b,refresh:l}=u(q,{}),[o,x]=c.useState(),[d,g]=c.useState(""),{setOpen:r,modalProps:f}=A({service:L,onOk:()=>{r(!1),l()}}),[v,a]=c.useState(!1),{run:O}=u(M,{manual:!0,onSuccess:()=>{t.success("删除成功"),r(!1),l()}});if(b)return e.jsx(h,{className:"subscribe-loading-card",children:e.jsx(Y,{active:!0})});const S=i.filter(s=>o?s.title.toUpperCase().includes(o.toUpperCase())||s.num.toUpperCase().includes(o.toUpperCase()):!0);return e.jsxs("div",{className:"subscribe-container",children:[e.jsx(w,{children:e.jsx(y,{span:24,lg:{span:6,offset:18},children:e.jsxs(C.Compact,{className:"subscribe-search-bar",children:[e.jsx(G,{allowClear:!0,value:d,onChange:s=>g(s.target.value),onPressEnter:()=>x(d),placeholder:"搜索番号或标题"}),e.jsx(j,{icon:e.jsx(R,{}),onClick:()=>x(d),className:"subscribe-search-btn"})]})})}),e.jsx(w,{gutter:[15,15],children:S.length>0?S.map(s=>e.jsx(y,{span:24,md:12,lg:6,children:e.jsx(h,{hoverable:!0,size:"small",className:"subscribe-card",cover:e.jsx(z,{src:s.cover}),onClick:()=>r(!0,s),children:e.jsx(h.Meta,{title:e.jsx("div",{className:"subscribe-card-title",children:s.title||s.num}),description:e.jsxs("div",{className:"flex",children:[e.jsxs(C,{size:[0,"small"],wrap:!0,className:"flex-1",children:[s.premiered&&e.jsx(p,{className:"subscribe-tag subscribe-tag-date",children:s.premiered}),s.is_hd&&e.jsx(p,{className:"subscribe-tag subscribe-tag-hd",children:"高清"}),s.is_zh&&e.jsx(p,{className:"subscribe-tag subscribe-tag-zh",children:"中文"}),s.is_uncensored&&e.jsx(p,{className:"subscribe-tag subscribe-tag-uncensored",children:"无码"})]}),e.jsx(m,{title:"搜索",children:e.jsx("div",{className:"subscribe-search-icon",onClick:E=>(E.stopPropagation(),n({to:"/search",search:{num:s.num}})),children:e.jsx(R,{})})})]})})})},s.id)):e.jsx(y,{span:24,children:e.jsx(h,{className:"subscribe-empty-card",children:e.jsx(J,{description:"无订阅",className:"subscribe-empty"})})})}),e.jsx(Q,{width:1100,onDelete:O,...f}),e.jsx(ae,{open:v,onCancel:()=>a(!1),onResubscribe:()=>{l(),a(!1)}}),e.jsx(e.Fragment,{children:W.createPortal(e.jsxs(e.Fragment,{children:[e.jsx(I,{icon:e.jsx(X,{}),type:"primary",onClick:()=>r(!0),className:"subscribe-float-btn"}),e.jsx(I,{icon:e.jsx(Z,{}),onClick:()=>a(!0),className:"subscribe-float-btn"})]}),document.getElementsByClassName("index-float-button-group")[0])})]})}export{re as component};
