# å¯åŠ¨æ£€æŸ¥è„šæœ¬ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°
`startup_check.py` æ˜¯ä¸€ä¸ªç”¨äºæ£€æµ‹å’Œä¿®å¤ç”Ÿäº§ç¯å¢ƒé—®é¢˜çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œä¸“é—¨è§£å†³æ•°æ®åº“è¿ç§»ã€æšä¸¾å€¼æ ¼å¼ç­‰å¸¸è§é—®é¢˜ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” æ£€æŸ¥é¡¹ç›®
- **æ•°æ®åº“è¿æ¥**: éªŒè¯SQLiteæ•°æ®åº“æ˜¯å¦å¯è®¿é—®
- **è¿ç§»çŠ¶æ€**: æ£€æŸ¥Alembicè¿ç§»æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬
- **æšä¸¾å€¼æ ¼å¼**: æ£€æŸ¥time_range_typeå’Œstatuså­—æ®µæ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„å°å†™æ ¼å¼
- **è¡¨ç»“æ„**: éªŒè¯å¿…éœ€çš„åŸºç±»å­—æ®µ(create_by, create_time, update_by, update_time)æ˜¯å¦å­˜åœ¨

### ğŸ”§ è‡ªåŠ¨ä¿®å¤
- è‡ªåŠ¨è¿è¡Œæ•°æ®åº“è¿ç§»(`alembic upgrade head`)
- ä¿®å¤æšä¸¾å€¼å¤§å°å†™é—®é¢˜
- æ·»åŠ ç¼ºå¤±çš„è¡¨å­—æ®µ
- ç”Ÿæˆè¯¦ç»†çš„æ£€æŸ¥å’Œä¿®å¤æŠ¥å‘Š

## ä½¿ç”¨æ–¹æ³•

### æœ¬åœ°å¼€å‘ç¯å¢ƒ
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
python startup_check.py

# æˆ–è€…ä½¿ç”¨å¯æ‰§è¡Œæƒé™
./startup_check.py
```

### ç”Ÿäº§ç¯å¢ƒ(Docker)
```bash
# å¤åˆ¶è„šæœ¬åˆ°å®¹å™¨
docker cp startup_check.py tissue_container:/app/

# åœ¨å®¹å™¨å†…è¿è¡Œ
docker exec -it tissue_container python /app/startup_check.py

# æˆ–è€…ç›´æ¥è¿è¡Œ
docker exec -it tissue_container /app/startup_check.py
```

### ç”Ÿäº§ç¯å¢ƒ(ç›´æ¥éƒ¨ç½²)
```bash
# åœ¨é¡¹ç›®ç›®å½•è¿è¡Œ
cd /path/to/tissue
python startup_check.py
```

## è¾“å‡ºè¯´æ˜

### æ£€æŸ¥ç»“æœç¤ºä¾‹
```
==================================================
å¯åŠ¨æ£€æŸ¥æŠ¥å‘Š
==================================================

ğŸ“Š æ£€æŸ¥ç»“æœ:
  âœ… database_connection: é€šè¿‡
  âœ… migration_status: é€šè¿‡
  âœ… enum_values: é€šè¿‡
  âœ… required_columns: é€šè¿‡

ğŸ“‹ æ€»ç»“: æ‰€æœ‰æ£€æŸ¥é€šè¿‡
```

### é—®é¢˜å‘ç°ç¤ºä¾‹
```
==================================================
å¯åŠ¨æ£€æŸ¥æŠ¥å‘Š
==================================================

ğŸ“Š æ£€æŸ¥ç»“æœ:
  âœ… database_connection: é€šè¿‡
  âŒ migration_status: å¤±è´¥
  âŒ enum_values: å¤±è´¥
  âŒ required_columns: å¤±è´¥

âš ï¸ å‘ç°çš„é—®é¢˜:
  - æ•°æ®åº“è¿ç§»ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬
  - å‘ç° 5 æ¡æ—§æ ¼å¼æšä¸¾å€¼è®°å½•
  - ç¼ºå°‘å¿…éœ€çš„åˆ—: ['create_by', 'create_time']

ğŸ”§ åº”ç”¨çš„ä¿®å¤:
  - æ•°æ®åº“è¿ç§»ä¿®å¤æˆåŠŸ

ğŸ“‹ æ€»ç»“: å­˜åœ¨é—®é¢˜éœ€è¦æ‰‹åŠ¨å¤„ç†
```

## æ–‡ä»¶è¾“å‡º
- æ£€æŸ¥æŠ¥å‘Šè‡ªåŠ¨ä¿å­˜åˆ° `startup_check_report.txt`
- æ—¥å¿—ä¿¡æ¯å®æ—¶æ˜¾ç¤ºåœ¨æ§åˆ¶å°

## é€€å‡ºç 
- `0`: æ‰€æœ‰æ£€æŸ¥é€šè¿‡
- `1`: å­˜åœ¨é—®é¢˜éœ€è¦å¤„ç†

## å¸¸è§é—®é¢˜è§£å†³

### 1. æšä¸¾å€¼æ ¼å¼é”™è¯¯
**é—®é¢˜**: `'week' is not among the defined enum values`
**è§£å†³**: è„šæœ¬ä¼šè‡ªåŠ¨è¿è¡Œè¿ç§»ä¿®å¤æšä¸¾å€¼å¤§å°å†™

### 2. ç¼ºå°‘è¡¨å­—æ®µ
**é—®é¢˜**: è¡¨ç»“æ„ä¸å®Œæ•´
**è§£å†³**: è„šæœ¬ä¼šè‡ªåŠ¨æ·»åŠ ç¼ºå¤±çš„åŸºç±»å­—æ®µ

### 3. è¿ç§»çŠ¶æ€å¼‚å¸¸
**é—®é¢˜**: æ•°æ®åº“ç‰ˆæœ¬ä¸åŒ¹é…
**è§£å†³**: è‡ªåŠ¨è¿è¡Œ`alembic upgrade head`

## é›†æˆåˆ°éƒ¨ç½²æµç¨‹

### 1. å¯åŠ¨è„šæœ¬é›†æˆ
```bash
#!/bin/bash
# åœ¨åº”ç”¨å¯åŠ¨å‰è¿è¡Œæ£€æŸ¥
python startup_check.py
if [ $? -ne 0 ]; then
    echo "å¯åŠ¨æ£€æŸ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"
    exit 1
fi

# å¯åŠ¨åº”ç”¨
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 2. Dockeré›†æˆ
```dockerfile
# åœ¨Dockerfileä¸­æ·»åŠ 
COPY startup_check.py /app/
RUN chmod +x /app/startup_check.py

# åœ¨entrypointä¸­ä½¿ç”¨
ENTRYPOINT ["/app/startup_check.py && python -m uvicorn app.main:app --host 0.0.0.0 --port 8000"]
```

### 3. å®šæ—¶æ£€æŸ¥
```bash
# æ·»åŠ åˆ°crontabè¿›è¡Œå®šæœŸæ£€æŸ¥
0 2 * * * cd /path/to/tissue && python startup_check.py
```

## æ³¨æ„äº‹é¡¹
- ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•(åŒ…å«alembic.ini)ä¸­è¿è¡Œ
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å…ˆå¤‡ä»½æ•°æ®åº“
- è„šæœ¬ä¼šè‡ªåŠ¨ä¿®å¤å¸¸è§é—®é¢˜ï¼Œä½†å¤æ‚é—®é¢˜å¯èƒ½éœ€è¦æ‰‹åŠ¨å¤„ç†
- æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä»¥è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯